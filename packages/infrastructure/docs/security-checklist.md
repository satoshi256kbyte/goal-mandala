# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

## æ¦‚è¦

CDKãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å¿…ãšç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

### ğŸ” èªè¨¼ãƒ»èªå¯

- [ ] **IAMæ¨©é™ã®æœ€å°åŒ–**: å„ãƒªã‚½ãƒ¼ã‚¹ã«å¿…è¦æœ€å°é™ã®æ¨©é™ã®ã¿ä»˜ä¸
- [ ] **IAMãƒ­ãƒ¼ãƒ«ã®é©åˆ‡ãªè¨­å®š**: ã‚µãƒ¼ãƒ“ã‚¹é–“ã®æ¨©é™ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] **ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã®åˆ¶é™**: ä¸è¦ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆé–“ã‚¢ã‚¯ã‚»ã‚¹ãŒãªã„
- [ ] **ä¸€æ™‚çš„ãªèªè¨¼æƒ…å ±ã®ä½¿ç”¨**: é•·æœŸé–“æœ‰åŠ¹ãªèªè¨¼æƒ…å ±ã‚’é¿ã‘ã‚‹

### ğŸ›¡ï¸ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- [ ] **VPCã®é©åˆ‡ãªè¨­å®š**: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã®ä½¿ç”¨
- [ ] **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®æœ€å°åŒ–**: å¿…è¦æœ€å°é™ã®ãƒãƒ¼ãƒˆãƒ»ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ã¿è¨±å¯
- [ ] **NACLã®è¨­å®š**: å¿…è¦ã«å¿œã˜ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ACLã‚’è¨­å®š
- [ ] **VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä½¿ç”¨**: AWSã‚µãƒ¼ãƒ“ã‚¹ã¸ã®é€šä¿¡ã‚’ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«ä¿ã¤

### ğŸ”’ ãƒ‡ãƒ¼ã‚¿ä¿è­·

- [ ] **ä¿å­˜æ™‚æš—å·åŒ–**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€S3ãƒã‚±ãƒƒãƒˆã®æš—å·åŒ–æœ‰åŠ¹åŒ–
- [ ] **è»¢é€æ™‚æš—å·åŒ–**: HTTPS/TLSé€šä¿¡ã®å¼·åˆ¶
- [ ] **æ©Ÿå¯†æƒ…å ±ã®ç®¡ç†**: Secrets Managerã§ã®æ©Ÿå¯†æƒ…å ±ç®¡ç†
- [ ] **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®æš—å·åŒ–**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–

### ğŸ“ ãƒ­ã‚°ãƒ»ç›£è¦–

- [ ] **CloudTrailã®æœ‰åŠ¹åŒ–**: APIå‘¼ã³å‡ºã—ãƒ­ã‚°ã®è¨˜éŒ²
- [ ] **VPCãƒ•ãƒ­ãƒ¼ãƒ­ã‚°**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ç›£è¦–
- [ ] **CloudWatchãƒ­ã‚°**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã®é›†ç´„
- [ ] **ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®é€šçŸ¥

### ğŸ·ï¸ ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†

- [ ] **ã‚¿ã‚°ä»˜ã‘ã®çµ±ä¸€**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ã®ãŸã‚ã®ã‚¿ã‚°è¨­å®š
- [ ] **ãƒªã‚½ãƒ¼ã‚¹å‘½åè¦ç´„**: ä¸€è²«ã—ãŸå‘½åè¦ç´„ã®é©ç”¨
- [ ] **å‰Šé™¤ä¿è­·**: é‡è¦ãªãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤ä¿è­·è¨­å®š
- [ ] **ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: S3ãƒã‚±ãƒƒãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹åŒ–

## ç’°å¢ƒåˆ¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

### é–‹ç™ºç’°å¢ƒ (dev)

```typescript
// é–‹ç™ºç’°å¢ƒã§ã¯ç·©ã„è¨­å®šã‚‚è¨±å¯
const devSecurityConfig = {
  database: {
    deletionProtection: false,
    backupRetention: 7, // 7æ—¥é–“
    encryption: true,
  },
  s3: {
    versioning: false,
    publicAccess: false,
  },
  lambda: {
    reservedConcurrency: 10,
  },
};
```

### ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ (stg)

```typescript
// æœ¬ç•ªã«è¿‘ã„è¨­å®šã§ãƒ†ã‚¹ãƒˆ
const stgSecurityConfig = {
  database: {
    deletionProtection: true,
    backupRetention: 14, // 14æ—¥é–“
    encryption: true,
  },
  s3: {
    versioning: true,
    publicAccess: false,
  },
  lambda: {
    reservedConcurrency: 50,
  },
};
```

### æœ¬ç•ªç’°å¢ƒ (prod)

```typescript
// æœ€é«˜ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
const prodSecurityConfig = {
  database: {
    deletionProtection: true,
    backupRetention: 30, // 30æ—¥é–“
    encryption: true,
    multiAZ: true,
  },
  s3: {
    versioning: true,
    publicAccess: false,
    mfaDelete: true,
  },
  lambda: {
    reservedConcurrency: 100,
  },
};
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰

### CDK Nagå®Ÿè¡Œ

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
pnpm cdk synth --context environment=prod

# ç‰¹å®šã®ãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã§ãƒã‚§ãƒƒã‚¯
pnpm cdk synth --context environment=prod --context cdkNagRules=AWS-Solutions
```

### AWS Config Rules

```bash
# ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
aws configservice get-compliance-details-by-config-rule \
  --config-rule-name encrypted-volumes

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ãƒã‚§ãƒƒã‚¯
aws configservice get-compliance-details-by-config-rule \
  --config-rule-name security-group-ssh-check
```

### AWS Security Hub

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¨™æº–ã®ç¢ºèª
aws securityhub get-enabled-standards

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚¡ã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ç¢ºèª
aws securityhub get-findings \
  --filters '{"SeverityLabel":[{"Value":"HIGH","Comparison":"EQUALS"}]}'
```

## è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³

### ä¾å­˜é–¢ä¿‚ã‚¹ã‚­ãƒ£ãƒ³

```bash
# npm audit
pnpm audit

# Snyk ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆå°å…¥ã—ã¦ã„ã‚‹å ´åˆï¼‰
npx snyk test

# OWASP Dependency Check
dependency-check --project "goal-mandala" --scan ./
```

### ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³

```bash
# ESLint ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
pnpm lint

# SonarQube ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆå°å…¥ã—ã¦ã„ã‚‹å ´åˆï¼‰
sonar-scanner

# CodeQL ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆGitHub Actionsï¼‰
# .github/workflows/codeql-analysis.yml ã§è¨­å®š
```

## ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †

### 1. æ¤œçŸ¥ãƒ»åˆæœŸå¯¾å¿œ

```bash
# ç·Šæ€¥æ™‚ã®ãƒªã‚½ãƒ¼ã‚¹åœæ­¢
aws lambda put-function-concurrency \
  --function-name goal-mandala-prod-api \
  --reserved-concurrent-executions 0

# CloudFrontç„¡åŠ¹åŒ–
aws cloudfront create-invalidation \
  --distribution-id E1234567890123 \
  --paths "/*"
```

### 2. èª¿æŸ»ãƒ»åˆ†æ

```bash
# CloudTrail ãƒ­ã‚°ç¢ºèª
aws logs filter-log-events \
  --log-group-name /aws/cloudtrail \
  --start-time $(date -d '1 hour ago' +%s)000

# VPC ãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ç¢ºèª
aws logs filter-log-events \
  --log-group-name /aws/vpc/flowlogs \
  --filter-pattern '[srcaddr="suspicious-ip"]'
```

### 3. å¾©æ—§ãƒ»æ”¹å–„

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒé©ç”¨
pnpm update

# è¨­å®šã®ä¿®æ­£ãƒ»å†ãƒ‡ãƒ—ãƒ­ã‚¤
./scripts/deploy.sh prod --no-approval

# ç›£è¦–å¼·åŒ–
aws logs put-metric-filter \
  --log-group-name /aws/lambda/goal-mandala-prod-api \
  --filter-name SecurityAlerts \
  --filter-pattern "ERROR"
```

## å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»

### æœˆæ¬¡ãƒã‚§ãƒƒã‚¯

- [ ] IAMã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®è¦‹ç›´ã—
- [ ] CloudTrailãƒ­ã‚°ã®åˆ†æ

### å››åŠæœŸãƒã‚§ãƒƒã‚¯

- [ ] ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³
- [ ] ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®è¦‹ç›´ã—
- [ ] ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †ã®ç¢ºèª

### å¹´æ¬¡ãƒã‚§ãƒƒã‚¯

- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®è¦‹ç›´ã—
- [ ] ç½å®³å¾©æ—§è¨ˆç”»ã®ç¢ºèª
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®ã®å®Ÿæ–½
- [ ] å¤–éƒ¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«è¨­å®š

### AWS Security Hub

```typescript
// CDKã§Security Hubæœ‰åŠ¹åŒ–
const securityHub = new securityhub.CfnHub(this, 'SecurityHub', {
  tags: [
    {
      key: 'Environment',
      value: props.environment,
    },
  ],
});
```

### AWS GuardDuty

```typescript
// CDKã§GuardDutyæœ‰åŠ¹åŒ–
const guardDuty = new guardduty.CfnDetector(this, 'GuardDuty', {
  enable: true,
  findingPublishingFrequency: 'FIFTEEN_MINUTES',
});
```

### AWS Config

```typescript
// CDKã§Configæœ‰åŠ¹åŒ–
const configRecorder = new config.CfnConfigurationRecorder(this, 'ConfigRecorder', {
  name: 'default',
  roleArn: configRole.roleArn,
  recordingGroup: {
    allSupported: true,
    includeGlobalResourceTypes: true,
  },
});
```

## ç·Šæ€¥é€£çµ¡å…ˆ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Š

- **ãƒ—ãƒ©ã‚¤ãƒãƒª**: <security@company.com>
- **ã‚»ã‚«ãƒ³ãƒ€ãƒª**: <admin@company.com>
- **ç·Šæ€¥æ™‚é›»è©±**: +81-XX-XXXX-XXXX

### ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

1. **Level 1**: é–‹ç™ºãƒãƒ¼ãƒ ï¼ˆå³åº§ã«å¯¾å¿œï¼‰
2. **Level 2**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ï¼ˆ30åˆ†ä»¥å†…ï¼‰
3. **Level 3**: çµŒå–¶é™£ï¼ˆé‡å¤§ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®å ´åˆï¼‰

## å‚è€ƒè³‡æ–™

- [AWS ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://aws.amazon.com/security/security-learning/)
- [CDK ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰](https://docs.aws.amazon.com/cdk/v2/guide/security.html)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [NIST Cybersecurity Framework](https://www.nist.gov/cyberframework)
