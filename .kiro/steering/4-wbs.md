---
inclusion: always
---

# WBS（Work Breakdown Structure）

## 目的

このドキュメントは、プロジェクトの作業分解構造（WBS）と進捗状況を管理します。AI assistantは、新しいタスクを開始する前に、このドキュメントを参照して現在の進捗状況と優先順位を確認してください。

## 進捗管理ルール

### Spec作成ルール

1. **ワークパッケージごとにSpec作成**: 各WBS項目に対して、`.kiro/specs/`配下にSpecフォルダを作成
2. **Specフォルダ命名規則**: `{WBS番号}-{ワークパッケージ名の英語名のハイフン区切り}`
   - 例: `2.1.1-mandala-chart-display-component`
3. **複数Specの場合**: `{WBS番号}-{連番}-{名前}`の形式で連番を付与
   - 例: `2.4.9-1-test-architecture-overhaul`, `2.4.9-2-test-performance-improvement`
4. **進捗反映**: Spec更新時は、必ずこのファイル（4-wbs.md）の該当箇所を更新

### タスク実装ルール

1. **テストファースト**: テストコード実装 → 実装 → テスト実行の順序を厳守
2. **コード品質チェック**: 各実装タスク完了時に以下を実行
   - `npm run format`: コードフォーマット
   - `npm run lint`: リント実行（エラー・警告ゼロ件を確認）
3. **進捗更新**: タスク完了時は、このWBSファイルのチェックボックスを更新

## 現在の優先順位

1. **最優先**: フェーズ3（活動機能開発）の完了
   - 3.1 タスク管理機能の完成（Lambda Handler、API統合）
   - 3.2 リマインド機能の実装
   - 3.3 Step Functions統合
2. **次優先**: フェーズ2の残タスク
   - 2.3.4 ダッシュボード画面（未着手）
3. **その後**: フェーズ4（完成・テスト）

## 進捗状況サマリー（2025年12月6日時点）

### フェーズ1: 基盤構築 ✅ 完了（100%）

**完了日**: 2025年11月初旬

**成果物**:
- 開発環境セットアップ（モノレポ、Docker、SAM CLI）
- インフラ基盤構築（CDK、VPC、Aurora、Secrets Manager、CloudFront + S3）
- 認証システム構築（Cognito、JWT認証）
- データベース設計・構築（Prismaスキーマ、マイグレーション）

### フェーズ2: コア機能開発 🚧 進行中（95%完了）

**進捗詳細**:
- ✅ マンダラチャート基本機能: 完了（5/5 = 100%）
- ✅ AI統合機能: 完了（5/5 = 100%）
- 🚧 ユーザー管理機能: 進行中（45/62 = 72.6%）
  - ✅ プロフィール管理API: 完了
  - ✅ プロフィール入力画面: 完了
  - ✅ マンダラチャート一覧画面: 完了
  - ⏸️ ダッシュボード画面: 未着手（0/17タスク）※優先度低
- ✅ テスト修正・品質向上: 完了（100%）

**テスト品質向上の成果**:
- テストファイル数: 205+ → 144（30%削減）
- 実行時間: 約18分 → 114.76秒（-99.3%）
- 成功率: 43.4% → 100%（+56.6%）
- カバレッジ: 14.60%（目標80%、改善計画策定済み）

### フェーズ3: 活動機能開発 🚧 進行中（30%完了）

**現在の焦点**: このフェーズの完了が最優先

**進捗詳細**:
- 🚧 タスク管理機能: 進行中（60%完了）
  - ✅ データベーススキーマ: 完了
  - ✅ バックエンドサービス: 完了（TaskService, FilterService, ProgressService, NotificationService）
  - ⚠️ Lambda Handler: 未完了（スタブのみ）
  - ✅ フロントエンドコンポーネント: 完了（TaskCard, ProgressBar, TaskFilter, TaskSearch）
  - ✅ フロントエンドページ: 完了（TaskListPage, TaskDetailPage）
  - ⚠️ API統合: 未完了
  - ⚠️ プロパティベーステスト: 未完了（0/20プロパティ）
- ⏸️ リマインド機能: 未着手（0%）
- ⏸️ Step Functions統合: 未着手（0%）

**次のアクション**:
1. Lambda Handlerの実装完了
2. API統合の実装
3. プロパティベーステストの実装

### フェーズ4: 完成・テスト ⏸️ 未着手（0%完了）

**開始条件**: フェーズ3の完了後

## AI Assistant向けガイドライン

### タスク開始前の確認事項

1. **WBS確認**: このドキュメントで現在の進捗状況と優先順位を確認
2. **Spec確認**: 該当するSpecファイル（`.kiro/specs/{WBS番号}-*/`）を確認
3. **依存関係確認**: 前提となるタスクが完了しているか確認
4. **関連ドキュメント確認**: 必要に応じて他のステアリングファイルを参照

### タスク実装時の手順

1. **テストファースト**: テストコード実装 → 実装 → テスト実行
2. **コード品質チェック**:
   ```bash
   npm run format  # コードフォーマット
   npm run lint    # リント実行（エラー・警告ゼロ件を確認）
   ```
3. **進捗更新**: タスク完了時は、このWBSファイルのチェックボックスを更新
4. **Spec更新**: Specファイルの進捗状況を更新

### 進捗ステータスの記号

- ✅ 完了
- 🚧 進行中
- ⏸️ 未着手
- ⚠️ ブロック中/問題あり

## 詳細WBS構造

### 1. 基盤構築

#### 1.1 開発環境セットアップ ✅

- [x] 1.1.1 モノレポ構成設定
- [x] 1.1.2 Docker Compose環境構築
- [x] 1.1.3 AWS SAM CLI環境構築
- [x] 1.1.4 開発ツール設定
- [x] 1.1.5 GitHub Actions基本設定

#### 1.2 インフラ基盤構築 ✅

- [x] 1.2.1 CDKプロジェクト初期化
- [x] 1.2.2 VPC・ネットワーク構成
- [x] 1.2.3 Aurora Serverless V2構築
- [x] 1.2.4 Secrets Manager設定
- [x] 1.2.5 CloudFront + S3構成

#### 1.3 認証システム構築 ✅

- [x] 1.3.1 Amazon Cognito設定
- [x] 1.3.2 JWT認証ミドルウェア実装
- [x] 1.3.3 認証画面実装
- [x] 1.3.4 認証状態管理実装

#### 1.4 データベース設計・構築 ✅

- [x] 1.4.1 ER図設計（→ [6-database-design.md](./6-database-design.md)）
- [x] 1.4.2 Prismaスキーマ定義
- [x] 1.4.3 マイグレーション実装
- [x] 1.4.4 シードデータ作成

### 2. コア機能開発

#### 2.1 マンダラチャート基本機能 ✅

- [x] 2.1.1 マンダラチャート表示コンポーネント（全15タスク完了）
- [x] 2.1.2 目標入力フォーム（全18タスク完了）
- [x] 2.1.3 サブ目標・アクション入力フォーム（全12タスク完了）
- [x] 2.1.4 進捗表示機能（全8タスク完了）
- [x] 2.1.5 編集機能（全17タスク完了）

#### 2.2 AI統合機能 ✅

- [x] 2.2.1 Bedrock Lambda関数実装（全14タスク完了、100%）
- [x] 2.2.2 サブ目標生成API（全13タスク完了、100%）
- [x] 2.2.3 アクション生成API（全14タスク完了、100%）
- [x] 2.2.4 タスク生成API（全14タスク完了、100%）
- [x] 2.2.5 非同期処理状態管理（全13タスク完了、100%）

#### 2.3 ユーザー管理機能 🚧

- [x] 2.3.1 プロフィール管理API（全10タスク完了、100%）
- [x] 2.3.2 プロフィール入力画面（全16タスク完了、100%）
- [x] 2.3.3 マンダラチャート一覧画面（全19タスク完了、100%）
- [ ] 2.3.4 ダッシュボード画面（0/17タスク、未着手）

#### 2.4 テスト修正・品質向上 ✅

- [x] 2.4.6 テストパフォーマンス改善（100%完了）
- [x] 2.4.9 テストアーキテクチャ刷新（100%完了）
  - 全13タスク完了（2025年11月23日）
  - 成果: テストファイル数87%削減、実行時間大幅短縮、成功率100%達成
- [x] 2.4.11 テスト環境メモリリーク修正（100%完了）
- [x] 2.4.12 段階的テスト追加（100%完了、2025年12月5日）
  - 全15タスク完了
  - 成果:
    - テスト成功率: 96.1% → 100%（+3.9%）
    - 実行テスト数: 2401/2424（23テストスキップ）
    - ファイル成功率: 98.6%（142/144ファイル）
    - 実行時間: 114.76秒
    - テスト安定性: 3回連続100%成功
    - カバレッジ測定: 14.60%（目標80%未達成、改善計画策定済み）
  - 主な修正内容:
    - 認証関連ページのモック設定修正（11テスト）
    - 下書き保存機能のテスト修正（6テスト）
    - DOMクエリエラー修正（122テスト）
    - 非同期処理の適切な待機実装（多数）
    - メモリ最適化設定（singleFork: false）

### 3. 活動機能開発 🚧 進行中

#### 3.1 タスク管理機能 🚧 進行中（60%完了）

**Specパス**: `.kiro/specs/3.1.1-task-management`

**サブタスク進捗**:
- [x] データベーススキーマ設計・実装
- [x] バックエンドサービス実装
  - [x] TaskService（タスクCRUD）
  - [x] FilterService（フィルタリング）
  - [x] ProgressService（進捗計算）
  - [x] NotificationService（通知管理）
- [ ] Lambda Handler実装（⚠️ スタブのみ、要実装）
- [x] フロントエンドコンポーネント実装
  - [x] TaskCard（タスクカード表示）
  - [x] ProgressBar（進捗バー）
  - [x] TaskFilter（フィルター）
  - [x] TaskSearch（検索）
- [x] フロントエンドページ実装
  - [x] TaskListPage（タスク一覧）
  - [x] TaskDetailPage（タスク詳細）
- [ ] API統合（⚠️ 未完了、次のアクション）
- [ ] プロパティベーステスト（⚠️ 0/20プロパティ、要実装）

**次のアクション**:
1. Lambda Handlerの完全実装
2. フロントエンドとバックエンドのAPI統合
3. プロパティベーステストの実装

#### 3.2 リマインド機能 ⏸️ 未着手（0%完了）

**依存関係**: 3.1タスク管理機能の完了

**サブタスク**:
- [ ] 3.2.1 SES統合（メール送信基盤）
- [ ] 3.2.2 メール生成機能（テンプレート、パーソナライズ）
- [ ] 3.2.3 配信スケジュール管理（平日AM10時、気分選択対応）
- [ ] 3.2.4 メール内リンク機能（タスク詳細への直接アクセス）

#### 3.3 Step Functions統合 ⏸️ 未着手（0%完了）

**依存関係**: 3.1タスク管理機能の完了

**サブタスク**:
- [ ] 3.3.1 ワークフロー定義（タスク生成フロー）
- [ ] 3.3.2 タスク生成処理（アクション→タスク変換）
- [ ] 3.3.3 状態監視機能（実行状況追跡）
- [ ] 3.3.4 エラーハンドリング（リトライ、通知）

### 4. 完成・テスト ⏸️ 未着手（0%完了）

**開始条件**: フェーズ3の完了

#### 4.1 振り返り機能 ⏸️ 未着手

**目的**: 目標達成状況の振り返りと改善点の記録

**サブタスク**:
- [ ] 4.1.1 振り返り入力画面（総括、惜しかったアクション、進まなかったアクション、未着手アクション）
- [ ] 4.1.2 振り返りAPI（CRUD操作）
- [ ] 4.1.3 履歴表示機能（過去の振り返り一覧）

#### 4.2 テスト実装 ⏸️ 未着手

**目標**: カバレッジ80%以上、E2Eテスト成功率95%以上

**サブタスク**:
- [ ] 4.2.1 ユニットテスト実装（カバレッジ80%達成）
- [ ] 4.2.2 E2Eテスト実装（主要ユーザーフロー）
- [ ] 4.2.3 パフォーマンステスト（API応答時間、ページロード時間）
- [ ] 4.2.4 セキュリティテスト（認証・認可、入力検証）

#### 4.3 本番デプロイ ⏸️ 未着手

**目的**: 本番環境での安定稼働

**サブタスク**:
- [ ] 4.3.1 本番環境構築（CDKデプロイ、環境変数設定）
- [ ] 4.3.2 監視・ログ設定（CloudWatch、アラート）
- [ ] 4.3.3 ドキュメント整備（運用手順、トラブルシューティング）

## 関連ドキュメント

AI assistantは、タスク実装時に以下のドキュメントを参照してください：

- [1-product-overview.md](./1-product-overview.md) - プロダクト概要、用語定義
- [2-technology-stack.md](./2-technology-stack.md) - 技術スタック、モノレポ構成
- [3-development-roadmap.md](./3-development-roadmap.md) - 開発ロードマップ、マイルストーン
- [5-screen-specifications.md](./5-screen-specifications.md) - 画面一覧と画面遷移図
- [6-database-design.md](./6-database-design.md) - ER図とテーブル定義
- [7-implementation-guide.md](./7-implementation-guide.md) - 実装ガイド、コーディング規約
- [8-security-guide.md](./8-security-guide.md) - セキュリティガイド
- [9-test-guide.md](./9-test-guide.md) - テストガイド、テスト戦略
- [10-aws-guide.md](./10-aws-guide.md) - AWS利用ガイド
- [11-react-hooks-best-practices.md](./11-react-hooks-best-practices.md) - React Hooksベストプラクティス

## 将来の拡張・改善タスク（Phase 2）

**注意**: これらのタスクはMVP完成後に実装します。現在は優先度が低いため、フェーズ1-4の完了を優先してください。

### 5. 将来の拡張機能 ⏸️ 未着手

**開始条件**: MVP（フェーズ1-4）の完了

#### 5.1 AI機能の拡張

**目的**: AI生成品質の向上とコスト最適化

- [ ] 5.1.1 カスタムメトリクス実装（生成品質評価）
- [ ] 5.1.2 コスト監視実装（Bedrock利用コスト追跡）
- [ ] 5.1.3 プロンプト最適化（A/Bテスト、品質向上）
- [ ] 5.1.4 複数モデル対応（Nova Pro、Claude等）
- [ ] 5.1.5 ストリーミングレスポンス対応（リアルタイム生成）
- [ ] 5.1.6 多言語対応（英語、中国語等）

#### 5.2 パフォーマンス改善

**目的**: システムパフォーマンスの向上

- [ ] 5.2.1 RDS Proxy導入（接続プール最適化）
- [ ] 5.2.2 レスポンスキャッシュ実装（API応答高速化）
- [ ] 5.2.3 Lambda Provisioned Concurrency（コールドスタート削減）

#### 5.3 運用改善

**目的**: 運用効率の向上

- [ ] 5.3.1 自動デプロイパイプライン（GitHub Actions完全自動化）
- [ ] 5.3.2 詳細な監視ダッシュボード（Grafana、カスタムメトリクス）
- [ ] 5.3.3 生成品質評価機能（ユーザーフィードバック収集）

## 重要な注記

### タスク優先度の変更履歴

- **2.2.1の一部タスク移動**: カスタムメトリクス、コスト監視、プロンプト最適化は、MVP完成後の拡張機能として5.1に移動しました。基本的なAI生成機能の動作には必須ではないため、優先度を下げました。
- **現在の監視体制**: 構造化ログとCloudWatchアラームは実装済みで、基本的な監視体制は整っています。

### カバレッジ改善計画

- **現状**: 14.60%（2025年12月6日時点）
- **目標**: 80%以上
- **計画**: フェーズ4.2.1で実装予定
