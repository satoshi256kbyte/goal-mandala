# プロジェクト概要

## プロジェクト名

曼荼羅目標管理

## 概要

メジャーリーガーの大谷翔平が使ったと言われるマンダラチャートを作成・運用するツールです。
目標を立てたはいいものの、目標達成までの道程が描けない、努力が継続しない人への補助を行うのが目的のツールです。
利用者が自然言語で目標を入力すると、AIが目標を達成するためのマンダラチャートを生成します。
マンダラチャートは目標に対して8つのサブ目標を設定し、さらに各サブ目標に対して8つのアクションを設定します。
AIはサブ目標のアクションを日々のTODOリストに落とし込みます。
1つのTODOの所要時間は30分程度で、システムはTODOリストは日々利用者にリマインドを行います。
利用者がTODOを達成すると、マンダラチャートの達成度が上がります。
最終的にマンダラチャートの達成度が100%になると、目標達成となります。

## 想定利用者

主にビジネスパーソンや学生で、3から6ヶ月程度の中長期的な目標を持つ人を想定しています。
ビジネスパーソンについては、目標管理の報告に活用することも想定しています。
それ以上の長期的な目標を持つ人は、一旦対象外とします。

## 用語

検討中

## 操作の流れ

- 目標を立てる時期
  - システムにログイン
    - 初回はプロフィール入力
      - 所属組織の情報
        - 業種
        - 組織規模
      - 本人の情報
        - 職種
        - 役職（任意）
  - 目標を入力
    - 入力項目
      - 目標のタイトル
      - 目標の説明
      - 目標の達成期限
      - 背景（置かれている状況、立場、その目標を立てた理由）
      - 制約事項（何らかの制約により実行できないこと）
  - 目標を入力したらAIがマンダラチャート作成
    - 最初のマンダラチャート
      - 目標に対して8つのサブ目標を設定
      - 8つのサブ目標ができた時点で、利用者に公開
    - 利用者は目標のマンダラチャートを確認
      - ウィザード形式の画面です
      - 利用者は違和感のある目標を修正する
      - 各目標は以下の入力項目を持つ
        - 目標のタイトル（中心の目標から達成期限を除いただけ、目標とサブ目標、サブ目標のアクションは木構造のデータ）
        - 目標の説明
        - 背景
        - 制約事項
      - OKとなったらサブ目標からアクションを作るよう指示しします。
      - 最初のマンダラチャートと同様の手順でサブ目標のアクションで作成しきる
    - 目標のマンダラチャートができたら「活動」を開始します
      - 「活動」を開始時点でアクションをTODOリストに変換します
      - アクションごとにAIにTODOリストを作ってもらいます
      - 一気にやるとタイムアウトになる恐れがあるので、StepFunctions＋LambdaでアクションごとにTODOリストを作ります
- 活動時期
  - 利用者に毎日TODOをメールでリマインドします
  - メールにはTODOの一覧とTODOの画面へのリンクがあります
  - TODO画面でステータスを入力します。
  - アクションを達成したら、サブ目標の進捗があがり、やがて達成になります。サブ目標の進捗があがれば中身の目標の進捗があがり、やがて達成になります。
- 振り返り
  - 振り返りに時間的制約はありません、どの段階で振り返ることができます
  - 振り返りの心理的リスクを下げるため、あまり細かく入力はしない方針とします
  - 総括と惜しかったアクション、思ったより進まなかったアクション、未着手となったアクションそれぞれにコメントを入れられるようにします

## 画面

- TOP
  - マンダラチャートの一覧を表示（一覧の列は目標タイトルと達成期間と進捗）
- マンダラチャート
  - 画面上部に目標、サブ目標、アクションが全部見えるマンダラチャートを表示します
    - 文字が小さくなったり省略表示になってもかまいません、全体が見えることを重視します
    - 目標、サブ目標、アクションは進捗表示します。
      - 進捗表示は色で表示、％の分だけマスがが下から埋まるイメージです
    - 目標、サブ目標、アクションに詳細アイコンクリックすると、ダイアログでその詳細を表示します。
      - ダイアログで編集も可能です。将来的にはここで編集したら全体の整合性をAIに見直してもらうべきですが、現時点では実装対象外します。
  - 画面下部はTODOリストです。
    - 検索、ソートが可能です。
    - マンダラチャート側で、目標、サブ目標、アクションを選択すると検索条件として追加されます。タグ表示です。そして、それに該当するTODOだけが表示されます。
    - リマインドメールのリンク先もここです
    - その時は、当日分の検索条件が効いた状態となり、当日リマインドされたものだけが表示されます。
    - 当日分の条件は解除可能です。
- マンダラチャート、振り返り
  - 振り返りの入力・確認ができます。

### AIによるマンダラチャート生成

- 時間がかかる処理なので、非同期処理とします
- 作成または修正を依頼したら受け付けたことだけを通知、ステータスを「処理中」に変更
- 利用者はリロードボタンで定期的に画面を更新して、ステータスが「完了」になったらマンダラチャートを確認

### TODOの種類

- アクションに対してTODOは1：Nです
- TODOの粒度を30分から60分とすると、1つのTODOでアクションが完了になり得ないものがあるからです
- アクションは実施すれば完了となるものと、継続しなければならないものの2つがあると思われます
- 実施すれば完了となるアクションは、アクションを構成するTODOを全てこなせば「達成」となります。途中段階は％表示します。
- 継続しなければならないアクションは、TODOもそれに準じたタイプとなります。継続のTODOは継続中かどうかを問います。目標達成期間の8割を継続中と回答すれば「達成」とみなします。

### リマインド

- 実施すれば完了となるアクションのTODOは、1日に最大3までリマインドします。（これが多いかどうかはわかりませんが、現時点ではこの仕様とします。）
- 継続が必要なアクションは、それらのアクションのTODOが一週間に1度必ずリマインドされるように分散させてリマインドします。
- 初回リマインドは上2つのルールに基づき完全ランダムでリマインドします。
- TODO画面でステータスを入力します。
- この時、最後に「明日もこのまま行く」か「明日は少し気分を変える」を選択します。
  - 「明日もこのまま行く」の場合、実施すれば完了となるアクションのTODOのうち、2/3を同じアクションまたはマンダラチャート的に隣接したアクションからTODOを選び、リマインド、残り1個はリマインド時期が古い方の10件からランダムで選ぶます。
  - 「明日は少し気分を変える」の場合、実施すれば完了となるアクションのTODOのうち、全部をリマインド時期が古い方の10件からランダムで選ぶます。

### 現時点ではやらないこと

以下のものは現時点では実装対象外です。
将来の実装候補とします。

- AIによるマンダラチャート生成現は詳細な進捗表示や完了通知は不要です
- TODOリストの見直し機能は不要です
  - 初回入力時にTODOリストまで確認させるのは利用者の負担と考えられるからです
  - 見直しをするとしたら、日々通知されたTODOを見た時と思われますが、これも現時点では実装対象外とします
- TODOのリマインドの指定機能は不要です
  - 現時点では平日AM10時（日本時間）固定とします 
- 継続が必要なアクションについて、どれぐらい継続すれば継続中とみなすかの変更機能は不要です
  -　継続が必要なアクションは1週間に一度リマインドするで固定です

## 技術スタック

- Single Page Application (SPA)
- インフラ: AWS
  - IaC
    - AWS CDK 
- バックエンド(API)
  - TypeScript + Hono
  - Amazon Cognitoで認証 
  - Amazon CloudFront > Amazon API Gateway > AWS Lambda(Hono) > Amazon Aurora Serverless V2
  - アクションごとのTODOを作る部分でStepFunctionsを使用
- フロントエンド
  - Amazon CloudFront > Amazon S3
  - React + TypeScript
  - CSSフレームワーク（検討中）
- 静的解析ツール
  - 検討中
- フォーマッター
  - 検討中
- テストツール
  - 検討中
- 配信
  - バックエンド、フロントエンド共にAmazon CloudFrontで配信
  - バックエンド、フロントエンドは同じCloudFrontディストリビューションに配置、故に同じドメインでアクセス可能
- CI/CD
  - IaC、バックエンド、フロントエンドを一つのリポジトリで管理するモノレポ構成とする
  - GitリポジトリはGitHubで管理
  - CI/CDツールはGitHub Actionsを使用
  - ユニットテストのカバレッジは80%以上を目指す
  - E2Eテストを実施
  - プリコミットでLintを実施
  - mainへのプッシュで静的解析・自動テスト・カバレッジチェック・E2Eテストを実施
  - AWSへのデプロイはGitHub Actionsで実施するが、実施は手動
- AI
  - Bedrock + Amazon Novaを想定
  - AIとの通信を行うのはLambda（故にAIへのリクエスト内容は15分以内に収まる程度に分解する）
- AIコーディング
  - 全面的にKiroを活用
  - MCP Serverを稼働させるためPythonを使用
    - PythonはMCPの稼働以外には使用しない
