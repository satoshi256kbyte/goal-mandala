# 要件定義書

## 概要

曼荼羅目標管理システムのデータベース設計において、Prismaスキーマファイルを作成し、ER図で定義されたデータ構造をPrisma ORMで実装可能な形式に変換します。TypeScriptでの型安全性を確保し、データベースマイグレーションとクライアント生成を可能にする設計を行います。

## 要件

### 要件1

**ユーザーストーリー:** バックエンド開発者として、ER図で設計されたデータ構造をPrismaスキーマで実装したい。そうすることで、型安全なデータベースアクセスが可能になる。

#### 受入基準

1. WHEN Prismaスキーマを作成する THEN User、Goal、SubGoal、Action、Task、TaskReminder、Reflectionの7つのモデルが定義される
2. WHEN リレーションシップを定義する THEN ER図で設計された1:N、1:8の関係がPrismaの関係記法で表現される
3. WHEN データ型を定義する THEN PostgreSQLに適したデータ型（UUID、DateTime、Enum等）が使用される
4. WHEN 制約条件を定義する THEN 主キー、外部キー、ユニーク制約がPrismaの記法で表現される

### 要件2

**ユーザーストーリー:** フロントエンド開発者として、Prismaクライアントから生成される型定義を活用したい。そうすることで、フロントエンドでも型安全なデータ操作が可能になる。

#### 受入基準

1. WHEN Enumを定義する THEN TaskType、TaskStatus、GoalStatus、UserIndustry等の列挙型が定義される
2. WHEN オプショナルフィールドを定義する THEN nullable項目が適切に?マークで表現される
3. WHEN デフォルト値を定義する THEN 作成日時、更新日時、ステータス等にデフォルト値が設定される
4. WHEN バリデーション属性を定義する THEN @db.VarChar()、@db.Text()等のデータベース固有属性が設定される

### 要件3

**ユーザーストーリー:** データベース管理者として、適切なインデックスとパフォーマンス最適化を実装したい。そうすることで、アプリケーションの応答性能を向上させることができる。

#### 受入基準

1. WHEN インデックスを定義する THEN @@index記法でユーザー目標一覧取得用のインデックスが作成される
2. WHEN 複合インデックスを定義する THEN 階層データ取得用の複合インデックスが作成される
3. WHEN ユニークインデックスを定義する THEN @@unique記法でユニーク制約が適用される
4. WHEN 外部キー制約を定義する THEN onDelete、onUpdateアクションが適切に設定される

### 要件4

**ユーザーストーリー:** DevOps担当者として、データベースマイグレーションを自動化したい。そうすることで、環境間でのスキーマ同期とデプロイメントを効率化できる。

#### 受入基準

1. WHEN マイグレーション設定を定義する THEN prisma/schema.prismaファイルが適切な場所に配置される
2. WHEN データベース接続を設定する THEN 環境変数を使用したデータベースURL設定が含まれる
3. WHEN クライアント生成設定を定義する THEN Prismaクライアントの出力先とプロバイダーが設定される
4. WHEN スキーマ検証を可能にする THEN prisma validateコマンドでスキーマの妥当性確認ができる
