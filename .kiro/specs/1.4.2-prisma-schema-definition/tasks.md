# タスク一覧

## 概要

曼荼羅目標管理システムのPrismaスキーマ定義に関する実装タスクを定義します。ER図で設計されたデータ構造をPrisma ORMで実装し、型安全なデータベースアクセスを実現します。

## 実装タスク

### タスク1: Prismaプロジェクト初期設定

**説明:** Prismaの基本設定とプロジェクト構造を構築する

**成果物:**
- `packages/backend/prisma/schema.prisma`
- Prismaクライアント設定
- データベース接続設定

**受入基準:**
- [x] Prismaクライアントが正常に生成される
- [x] PostgreSQLデータベースに接続できる
- [x] `prisma validate`コマンドが成功する
- [x] 環境変数でデータベースURLが設定される

**見積時間:** 2時間

---

### タスク2: 基本モデル定義

**説明:** User、Goal、SubGoal、Actionの基本モデルを定義する

**成果物:**
- Userモデル（id、email、name、業種等）
- Goalモデル（タイトル、説明、期限等）
- SubGoalモデル（8個の位置制約付き）
- Actionモデル（8個の位置制約付き）

**受入基準:**
- [x] 全モデルでUUID主キーが設定される
- [x] 適切な外部キー関係が定義される
- [x] 位置制約（0-7）がチェック制約で実装される
- [x] 進捗率制約（0-100）が実装される

**見積時間:** 4時間

---

### タスク3: タスク関連モデル定義

**説明:** Task、TaskReminder、Reflectionモデルを定義する

**成果物:**
- Taskモデル（タイトル、種別、ステータス等）
- TaskReminderモデル（リマインド機能）
- Reflectionモデル（振り返り機能）

**受入基準:**
- [x] TaskTypeとTaskStatusのEnum定義が完了する
- [x] ReminderStatusのEnum定義が完了する
- [x] 評価レーティング制約（1-5）が実装される
- [x] カスケード削除が適切に設定される

**見積時間:** 3時間

---

### タスク4: Enum定義とバリデーション

**説明:** 業種、会社規模、各種ステータスのEnum定義を行う

**成果物:**
- UserIndustry、CompanySizeのEnum
- GoalStatus、TaskStatus、ReminderStatusのEnum
- 各種チェック制約とバリデーション

**受入基準:**
- [x] 全Enumが適切に定義される
- [x] デフォルト値が設定される
- [x] 範囲制約が実装される
- [x] ユニーク制約が適切に設定される

**見積時間:** 2時間

---

### タスク5: インデックス設計と最適化

**説明:** パフォーマンス最適化のためのインデックスを設計・実装する

**成果物:**
- ユーザー目標一覧用インデックス
- 階層データ取得用複合インデックス
- リマインダー送信用インデックス
- 分析用インデックス

**受入基準:**
- [x] `@@index`記法で基本インデックスが定義される
- [x] 複合インデックスが適切に設計される
- [x] ユニークインデックスが設定される
- [x] クエリパフォーマンスが検証される

**見積時間:** 3時間

---

### タスク6: マイグレーション生成とテスト

**説明:** 初期マイグレーションを生成し、データベーススキーマを作成する

**成果物:**
- 初期マイグレーションファイル
- マイグレーション実行スクリプト
- スキーマ検証スクリプト

**受入基準:**
- [x] `prisma migrate dev`が正常に実行される
- [x] 生成されたSQLが期待通りの構造になる
- [x] 制約条件が正しく適用される
- [x] ロールバック可能な状態になる

**見積時間:** 2時間

---

### タスク7: シードデータ作成

**説明:** 開発・テスト用のシードデータを作成する

**成果物:**
- `prisma/seed.ts`
- テストユーザーとサンプルデータ
- シード実行スクリプト

**受入基準:**
- [x] テストユーザーが作成される
- [x] サンプル目標データが作成される
- [x] 階層構造のテストデータが作成される
- [x] `prisma db seed`が正常に実行される

**見積時間:** 2時間

---

### タスク8: 型定義生成とクライアント設定

**説明:** Prismaクライアントの生成と型定義の最適化を行う

**成果物:**
- 生成されたPrismaクライアント
- TypeScript型定義
- クライアント設定の最適化

**受入基準:**
- [x] `prisma generate`が正常に実行される
- [x] TypeScript型定義が生成される
- [x] 関連データを含む型が利用可能になる
- [x] クエリログ設定が適用される

**見積時間:** 2時間

---

### タスク9: スキーマ検証とドキュメント

**説明:** スキーマの妥当性検証とドキュメント整備を行う

**成果物:**
- スキーマ検証スクリプト
- データベース設計ドキュメント
- 使用方法ガイド

**受入基準:**
- [x] `prisma validate`が成功する
- [x] `prisma format`でフォーマットが統一される
- [x] ER図との整合性が確認される
- [x] 開発者向けドキュメントが作成される

**見積時間:** 2時間

---

### タスク10: パフォーマンステストと最適化

**説明:** 生成されたスキーマのパフォーマンステストと最適化を行う

**成果物:**
- パフォーマンステストスクリプト
- インデックス効果の検証
- クエリ最適化レポート

**受入基準:**
- [x] 基本的なCRUD操作のテストが完了する
- [x] 階層データ取得のパフォーマンステストが完了する
- [x] インデックスの効果が確認される
- [x] ボトルネックが特定・改善される

**見積時間:** 3時間

## 総見積時間

**合計:** 27時間

## 依存関係

- **前提条件:** 1.4.1 ER図設計の完了
- **並行可能:** なし（順次実行が必要）
- **後続タスク:** 1.4.3 データベースマイグレーション実装

## リスク要因

1. **PostgreSQL固有機能の制約**
   - 対策: Prismaでサポートされる機能の事前確認

2. **パフォーマンス要件の未達**
   - 対策: 段階的なインデックス追加とテスト

3. **型定義の複雑化**
   - 対策: 段階的な実装と検証

4. **マイグレーション失敗**
   - 対策: 開発環境での十分なテストとバックアップ
