# 要件定義書

## はじめに

この要件定義書は、ダッシュボード画面の実装について定義します。ユーザーが自分の目標達成状況を一目で把握し、最近の活動や統計情報を確認できるようにすることで、モチベーション維持と効率的な目標管理を支援します。

## 用語集

- **System**: 目標管理曼荼羅システム
- **User**: システムを利用するユーザー
- **Dashboard**: ダッシュボード画面
- **MandalaChart**: マンダラチャート（目標、サブ目標、アクションを含む構造）
- **Goal**: 中心目標
- **SubGoal**: サブ目標
- **Action**: アクション
- **Task**: タスク
- **Progress**: 進捗率（0-100の数値）
- **ActivityLog**: 活動ログ（タスク完了、目標更新などの履歴）
- **Statistics**: 統計情報（完了タスク数、達成率など）
- **QuickAction**: クイックアクション（よく使う機能への素早いアクセス）

## 要件

### 要件1: ダッシュボード画面表示

**ユーザーストーリー:** ユーザーとして、ダッシュボード画面にアクセスしたい。そうすることで、自分の目標達成状況を一目で把握できる。

#### 受入基準

1. WHEN ユーザーがダッシュボード画面（`/dashboard`）にアクセスする THEN Systemは認証済みユーザーのダッシュボードを表示する
2. WHEN ダッシュボード画面が表示される THEN ページタイトル「ダッシュボード」が表示される
3. WHEN ダッシュボード画面が表示される THEN 進捗サマリーセクションが表示される
4. WHEN ダッシュボード画面が表示される THEN 最近の活動セクションが表示される
5. WHEN ダッシュボード画面が表示される THEN 統計情報セクションが表示される
6. WHEN ダッシュボード画面が表示される THEN クイックアクションセクションが表示される

### 要件2: 進捗サマリー表示

**ユーザーストーリー:** ユーザーとして、全体の進捗状況を視覚的に確認したい。そうすることで、目標達成に向けた現在地を把握できる。

#### 受入基準

1. WHEN 進捗サマリーセクションが表示される THEN 「進捗サマリー」という見出しが表示される
2. WHEN 進捗サマリーセクションが表示される THEN アクティブな目標の総数が表示される
3. WHEN 進捗サマリーセクションが表示される THEN 完了した目標の総数が表示される
4. WHEN 進捗サマリーセクションが表示される THEN 全体の平均進捗率が表示される
5. WHEN 進捗サマリーセクションが表示される THEN 平均進捗率が円形プログレスバーで視覚的に表示される
6. WHEN 平均進捗率が0-30%である THEN プログレスバーが赤色で表示される
7. WHEN 平均進捗率が31-70%である THEN プログレスバーが黄色で表示される
8. WHEN 平均進捗率が71-100%である THEN プログレスバーが緑色で表示される
9. WHEN 進捗サマリーセクションが表示される THEN 今週完了したタスク数が表示される
10. WHEN 進捗サマリーセクションが表示される THEN 今月完了したタスク数が表示される

### 要件3: アクティブな目標カード表示

**ユーザーストーリー:** ユーザーとして、現在進行中の目標を確認したい。そうすることで、優先的に取り組むべき目標を把握できる。

#### 受入基準

1. WHEN 進捗サマリーセクションが表示される THEN アクティブな目標が最大3件カード形式で表示される
2. WHEN アクティブな目標カードが表示される THEN 目標タイトルが表示される
3. WHEN アクティブな目標カードが表示される THEN 進捗率が表示される
4. WHEN アクティブな目標カードが表示される THEN 達成期限が表示される
5. WHEN アクティブな目標カードが表示される THEN 進捗バーが表示される
6. WHEN 達成期限が7日以内である THEN 期限切れ警告アイコンが表示される
7. WHEN アクティブな目標カードをクリックする THEN Systemはマンダラチャート画面（`/mandala/:id`）に遷移する
8. WHEN アクティブな目標が3件を超える THEN 「すべて表示」リンクが表示される
9. WHEN 「すべて表示」リンクをクリックする THEN SystemはTOP画面（`/`）に遷移する

### 要件4: 最近の活動表示

**ユーザーストーリー:** ユーザーとして、最近の活動履歴を確認したい。そうすることで、自分の取り組みを振り返り、モチベーションを維持できる。

#### 受入基準

1. WHEN 最近の活動セクションが表示される THEN 「最近の活動」という見出しが表示される
2. WHEN 最近の活動セクションが表示される THEN 最新10件の活動ログがリスト形式で表示される
3. WHEN 活動ログが表示される THEN 活動の種類（タスク完了、目標作成、目標更新など）が表示される
4. WHEN 活動ログが表示される THEN 活動の内容（タスク名、目標名など）が表示される
5. WHEN 活動ログが表示される THEN 活動の日時が相対時間（「2時間前」「昨日」など）で表示される
6. WHEN タスク完了の活動ログである THEN チェックマークアイコンが表示される
7. WHEN 目標作成の活動ログである THEN プラスアイコンが表示される
8. WHEN 目標更新の活動ログである THEN 編集アイコンが表示される
9. WHEN 活動ログをクリックする THEN 関連するマンダラチャート画面またはタスク詳細画面に遷移する
10. WHEN 活動ログが10件を超える THEN 「もっと見る」リンクが表示される

### 要件5: 統計情報表示

**ユーザーストーリー:** ユーザーとして、自分の活動統計を確認したい。そうすることで、目標達成に向けた取り組みの傾向を把握できる。

#### 受入基準

1. WHEN 統計情報セクションが表示される THEN 「統計情報」という見出しが表示される
2. WHEN 統計情報セクションが表示される THEN 総タスク数が表示される
3. WHEN 統計情報セクションが表示される THEN 完了タスク数が表示される
4. WHEN 統計情報セクションが表示される THEN タスク完了率が表示される
5. WHEN 統計情報セクションが表示される THEN 今週の完了タスク数が表示される
6. WHEN 統計情報セクションが表示される THEN 今月の完了タスク数が表示される
7. WHEN 統計情報セクションが表示される THEN 平均タスク完了時間が表示される
8. WHEN 統計情報セクションが表示される THEN 最も進捗している目標が表示される
9. WHEN 統計情報セクションが表示される THEN 各統計項目がカード形式で表示される
10. WHEN 統計情報セクションが表示される THEN 各統計項目に適切なアイコンが表示される

### 要件6: クイックアクション表示

**ユーザーストーリー:** ユーザーとして、よく使う機能に素早くアクセスしたい。そうすることで、効率的にシステムを利用できる。

#### 受入基準

1. WHEN クイックアクションセクションが表示される THEN 「クイックアクション」という見出しが表示される
2. WHEN クイックアクションセクションが表示される THEN 「新しい目標を作成」ボタンが表示される
3. WHEN クイックアクションセクションが表示される THEN 「今日のタスクを確認」ボタンが表示される
4. WHEN クイックアクションセクションが表示される THEN 「振り返りを記録」ボタンが表示される
5. WHEN 「新しい目標を作成」ボタンをクリックする THEN Systemは目標入力画面（`/mandala/create/goal`）に遷移する
6. WHEN 「今日のタスクを確認」ボタンをクリックする THEN Systemはタスク一覧画面（`/tasks`）に遷移する
7. WHEN 「振り返りを記録」ボタンをクリックする THEN Systemは振り返り画面（`/mandala/:id/reflection`）に遷移する
8. WHEN クイックアクションボタンにホバーする THEN ボタンの色が変化する
9. WHEN クイックアクションボタンにフォーカスする THEN ボタンが視覚的にハイライトされる

### 要件7: データ取得機能

**ユーザーストーリー:** システム開発者として、ダッシュボードデータを効率的に取得したい。そうすることで、パフォーマンスを最適化できる。

#### 受入基準

1. WHEN ダッシュボード画面が表示される THEN SystemはGET /api/dashboard エンドポイントにリクエストを送信する
2. WHEN APIリクエストを送信する THEN 認証トークンがAuthorizationヘッダーに含まれる
3. WHEN APIレスポンスを受信する THEN 進捗サマリーデータが取得される
4. WHEN APIレスポンスを受信する THEN 最近の活動ログデータが取得される
5. WHEN APIレスポンスを受信する THEN 統計情報データが取得される
6. WHEN データ取得中である THEN ローディングスピナーが表示される
7. WHEN データ取得に失敗する THEN エラーメッセージ「データの取得に失敗しました」が表示される

### 要件8: 認証状態管理

**ユーザーストーリー:** システム開発者として、認証状態を適切に管理したい。そうすることで、未認証ユーザーのアクセスを防ぎ、セキュリティを確保できる。

#### 受入基準

1. WHEN 未認証ユーザーがダッシュボード画面にアクセスする THEN Systemはログイン画面（`/login`）にリダイレクトする
2. WHEN 認証トークンが期限切れである THEN Systemはログイン画面にリダイレクトする
3. WHEN 認証トークンが無効である THEN Systemはログイン画面にリダイレクトする
4. WHEN プロフィール未設定ユーザーがダッシュボード画面にアクセスする THEN Systemはプロフィール入力画面（`/profile/setup`）にリダイレクトする

### 要件9: レスポンシブデザイン

**ユーザーストーリー:** ユーザーとして、様々なデバイスでダッシュボードを閲覧したい。そうすることで、どのデバイスからでも快適に利用できる。

#### 受入基準

1. WHEN モバイル（< 768px）で表示する THEN 各セクションが1カラムで縦方向に配置される
2. WHEN タブレット（768px - 1024px）で表示する THEN 進捗サマリーと統計情報が2カラムで配置される
3. WHEN デスクトップ（> 1024px）で表示する THEN 進捗サマリー、最近の活動、統計情報が3カラムで配置される
4. WHEN モバイルで表示する THEN タッチ操作に適したボタンサイズ（最小44px × 44px）が確保される
5. WHEN 画面サイズが変更される THEN レイアウトが適切に調整される
6. WHEN モバイルで表示する THEN 統計情報カードが縦方向に配置される

### 要件10: アクセシビリティ対応

**ユーザーストーリー:** 支援技術を使用するユーザーとして、ダッシュボードを利用したい。そうすることで、全てのユーザーが平等にサービスを利用できる。

#### 受入基準

1. WHEN スクリーンリーダーを使用する THEN 各セクションの見出しが適切に読み上げられる
2. WHEN スクリーンリーダーを使用する THEN 進捗率が「進捗率XX%」として読み上げられる
3. WHEN キーボードで操作する THEN Tabキーで全てのボタンとリンクにフォーカスできる
4. WHEN キーボードで操作する THEN Enterキーでボタンとリンクを選択できる
5. WHEN フォーカスが移動する THEN フォーカスインジケーターが明確に表示される
6. WHEN 統計情報が表示される THEN aria-label属性が適切に設定される
7. WHEN 活動ログが表示される THEN role属性が適切に設定される

### 要件11: パフォーマンス要件

**ユーザーストーリー:** ユーザーとして、ダッシュボードを素早く表示したい。そうすることで、ストレスなく目標を管理できる。

#### 受入基準

1. WHEN ダッシュボード画面を表示する THEN 初回ロード時間が3秒以内である
2. WHEN APIリクエストを送信する THEN 95%のリクエストが2秒以内に完了する
3. WHEN 画像やアイコンを表示する THEN 遅延読み込みが適用される
4. WHEN データが更新される THEN 画面が500ms以内に更新される
5. WHEN 複数のAPIリクエストを送信する THEN 並列実行が適用される

### 要件12: エラーハンドリング

**ユーザーストーリー:** ユーザーとして、エラーが発生した場合に適切なフィードバックを受け取りたい。そうすることで、問題を理解し、適切に対処できる。

#### 受入基準

1. WHEN APIエラーが発生する THEN エラーメッセージが画面上部に表示される
2. WHEN ネットワークエラーが発生する THEN 「ネットワークエラーが発生しました」というメッセージが表示される
3. WHEN データ取得に失敗する THEN 「データの取得に失敗しました。もう一度お試しください。」というメッセージが表示される
4. WHEN 予期しないエラーが発生する THEN 「予期しないエラーが発生しました」というメッセージが表示される
5. WHEN エラーメッセージが表示される THEN 「再試行」ボタンが表示される
6. WHEN 「再試行」ボタンをクリックする THEN Systemはデータ取得を再実行する

### 要件13: 空状態表示

**ユーザーストーリー:** ユーザーとして、データが存在しない場合に適切なメッセージを表示したい。そうすることで、次のアクションを理解できる。

#### 受入基準

1. WHEN アクティブな目標が存在しない THEN 「まだアクティブな目標がありません」というメッセージが表示される
2. WHEN 最近の活動が存在しない THEN 「まだ活動履歴がありません」というメッセージが表示される
3. WHEN 空状態メッセージが表示される THEN 「新しい目標を作成」ボタンが表示される
4. WHEN 空状態の「新しい目標を作成」ボタンをクリックする THEN Systemは目標入力画面に遷移する

### 要件14: ユーザーエクスペリエンス

**ユーザーストーリー:** ユーザーとして、直感的で使いやすいダッシュボードを利用したい。そうすることで、効率的に目標を管理できる。

#### 受入基準

1. WHEN ダッシュボード画面が表示される THEN ウェルカムメッセージ「こんにちは、[ユーザー名]さん」が表示される
2. WHEN データ取得中である THEN スケルトンスクリーンが表示される
3. WHEN ボタンやリンクにホバーする THEN 視覚的なフィードバックが提供される
4. WHEN 統計情報が更新される THEN アニメーション効果が適用される
5. WHEN 進捗率が表示される THEN カウントアップアニメーションが適用される

### 要件15: ナビゲーション機能

**ユーザーストーリー:** ユーザーとして、ダッシュボードから他の画面に簡単に移動したい。そうすることで、スムーズにシステムを利用できる。

#### 受入基準

1. WHEN ダッシュボード画面が表示される THEN ナビゲーションメニューが表示される
2. WHEN ナビゲーションメニューが表示される THEN 「ダッシュボード」リンクが表示される
3. WHEN ナビゲーションメニューが表示される THEN 「マンダラチャート一覧」リンクが表示される
4. WHEN ナビゲーションメニューが表示される THEN 「タスク」リンクが表示される
5. WHEN ナビゲーションメニューが表示される THEN 「設定」リンクが表示される
6. WHEN 現在のページがダッシュボードである THEN 「ダッシュボード」リンクがアクティブ状態で表示される
7. WHEN ナビゲーションリンクをクリックする THEN 対応する画面に遷移する
