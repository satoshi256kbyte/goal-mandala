# 要件定義書

## 概要

曼荼羅目標管理システムのデータベース設計において、エンティティ関連図（ER図）を設計し、システムで扱うデータの構造とリレーションシップを定義します。マンダラチャートの階層構造（目標→サブ目標→アクション→タスク）を適切にモデル化し、データ整合性を保証する設計を行います。

## 要件

### 要件1

**ユーザーストーリー:** システム管理者として、マンダラチャートの階層構造を適切にデータベースで表現したい。そうすることで、目標からタスクまでの一貫した管理が可能になる。

#### 受入基準

1. WHEN ER図を設計する THEN User、Goal、SubGoal、Action、Task、TaskReminder、Reflectionの7つの主要エンティティが定義される
2. WHEN 階層構造を定義する THEN Goal→SubGoal（8個）→Action（8個）→Task（N個）の関係が正しく表現される
3. WHEN リレーションシップを設計する THEN 1:N、1:8の関係が適切に定義される
4. WHEN データ整合性を確保する THEN 外部キー制約により参照整合性が保証される

### 要件2

**ユーザーストーリー:** 開発者として、各エンティティの属性を明確に定義したい。そうすることで、アプリケーション開発時に必要なデータ項目が明確になる。

#### 受入基準

1. WHEN Userエンティティを定義する THEN id、email、name、業種、組織規模、職種、役職の属性が含まれる
2. WHEN Goalエンティティを定義する THEN タイトル、説明、期限、背景、制約事項、ステータス、進捗の属性が含まれる
3. WHEN SubGoal/Actionエンティティを定義する THEN タイトル、説明、背景、制約事項、位置、進捗の属性が含まれる
4. WHEN Taskエンティティを定義する THEN タイトル、説明、種別、ステータス、推定時間、完了日時の属性が含まれる

### 要件3

**ユーザーストーリー:** データベース管理者として、適切な制約条件を設定したい。そうすることで、データの品質と整合性を維持できる。

#### 受入基準

1. WHEN 主キー制約を設定する THEN 全テーブルでUUID型の主キーが定義される
2. WHEN 外部キー制約を設定する THEN カスケード削除により階層データの整合性が保たれる
3. WHEN ユニーク制約を設定する THEN ユーザーのメールアドレス、位置情報が適切に制約される
4. WHEN チェック制約を設定する THEN 進捗率（0-100）、位置（0-7）の範囲制約が適用される

### 要件4

**ユーザーストーリー:** パフォーマンス担当者として、効率的なデータアクセスのためのインデックスを設計したい。そうすることで、アプリケーションの応答性能を向上させることができる。

#### 受入基準

1. WHEN インデックスを設計する THEN ユーザーの目標一覧取得用のインデックスが作成される
2. WHEN インデックスを設計する THEN 階層データ取得用の複合インデックスが作成される
3. WHEN インデックスを設計する THEN リマインド送信用のインデックスが作成される
4. WHEN インデックスを設計する THEN 振り返り履歴取得用のインデックスが作成される

### 要件5

**ユーザーストーリー:** 開発者として、ER図とドキュメントが整備されていてほしい。そうすることで、データベース構造を理解し、効率的に開発を進めることができる。

#### 受入基準

1. WHEN ER図を作成する THEN Mermaid形式でエンティティとリレーションシップが視覚的に表現される
2. WHEN データモデルを文書化する THEN 各エンティティのTypeScriptインターフェースが定義される
3. WHEN 制約条件を文書化する THEN SQL形式で制約の実装例が提供される
4. WHEN インデックス設計を文書化する THEN SQL形式でインデックス作成文が提供される
