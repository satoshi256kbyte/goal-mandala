# 要件定義書

## はじめに

この要件定義書は、マンダラチャート一覧画面（TOP画面）の実装について定義します。ユーザーが作成した全てのマンダラチャートを一覧表示し、検索・フィルター・ソート機能を提供することで、効率的にマンダラチャートを管理できるようにします。

## 用語集

- **System**: 目標管理曼荼羅システム
- **User**: システムを利用するユーザー
- **MandalaChart**: マンダラチャート（目標、サブ目標、アクションを含む構造）
- **Goal**: 中心目標
- **GoalStatus**: 目標の状態（draft: 下書き、active: 活動中、completed: 完了、paused: 一時停止、cancelled: 中止）
- **Progress**: 進捗率（0-100の数値）
- **SearchKeyword**: 検索キーワード
- **FilterCondition**: フィルター条件
- **SortOrder**: ソート順序

## 要件

### 要件1: マンダラチャート一覧表示

**ユーザーストーリー:** ユーザーとして、自分が作成した全てのマンダラチャートを一覧で確認したい。そうすることで、複数の目標を管理し、適切なマンダラチャートを選択できる。

#### 受入基準

1. WHEN ユーザーがTOP画面（`/`）にアクセスする THEN Systemは認証済みユーザーのマンダラチャート一覧を表示する
2. WHEN マンダラチャート一覧が表示される THEN 各マンダラチャートカードに目標タイトルが表示される
3. WHEN マンダラチャート一覧が表示される THEN 各マンダラチャートカードに目標説明（最大100文字、超過時は省略記号）が表示される
4. WHEN マンダラチャート一覧が表示される THEN 各マンダラチャートカードに達成期限が表示される
5. WHEN マンダラチャート一覧が表示される THEN 各マンダラチャートカードに進捗率が表示される
6. WHEN マンダラチャート一覧が表示される THEN 各マンダラチャートカードに目標状態（下書き/活動中/完了/一時停止/中止）が表示される
7. WHEN マンダラチャート一覧が表示される THEN 各マンダラチャートカードに作成日時が表示される
8. WHEN マンダラチャート一覧が表示される THEN 各マンダラチャートカードに更新日時が表示される

### 要件2: マンダラチャートカード表示

**ユーザーストーリー:** ユーザーとして、マンダラチャートの概要を視覚的に理解したい。そうすることで、一目で状態を把握できる。

#### 受入基準

1. WHEN マンダラチャートカードが表示される THEN カード形式で表示される
2. WHEN マンダラチャートカードが表示される THEN 進捗率が円形プログレスバーで視覚的に表示される
3. WHEN 進捗率が0-30%である THEN プログレスバーが赤色で表示される
4. WHEN 進捗率が31-70%である THEN プログレスバーが黄色で表示される
5. WHEN 進捗率が71-100%である THEN プログレスバーが緑色で表示される
6. WHEN 目標状態が「下書き」である THEN グレーのバッジで「下書き」と表示される
7. WHEN 目標状態が「活動中」である THEN 青色のバッジで「活動中」と表示される
8. WHEN 目標状態が「完了」である THEN 緑色のバッジで「完了」と表示される
9. WHEN 目標状態が「一時停止」である THEN オレンジ色のバッジで「一時停止」と表示される
10. WHEN 目標状態が「中止」である THEN 赤色のバッジで「中止」と表示される
11. WHEN 達成期限が過ぎている AND 目標状態が「活動中」である THEN 期限切れアイコンが表示される

### 要件3: マンダラチャート選択機能

**ユーザーストーリー:** ユーザーとして、一覧から特定のマンダラチャートを選択したい。そうすることで、詳細画面に遷移して内容を確認・編集できる。

#### 受入基準

1. WHEN マンダラチャートカードをクリックする THEN Systemはマンダラチャート詳細画面（`/mandala/:id`）に遷移する
2. WHEN マンダラチャートカードにホバーする THEN カードが視覚的にハイライトされる
3. WHEN マンダラチャートカードにフォーカスする THEN カードが視覚的にハイライトされる
4. WHEN キーボードでEnterキーを押す AND マンダラチャートカードにフォーカスしている THEN Systemはマンダラチャート詳細画面に遷移する

### 要件4: 新規マンダラチャート作成機能

**ユーザーストーリー:** ユーザーとして、新しいマンダラチャートを作成したい。そうすることで、新しい目標を設定できる。

#### 受入基準

1. WHEN TOP画面が表示される THEN 「新規作成」ボタンが画面右上に表示される
2. WHEN 「新規作成」ボタンをクリックする THEN Systemは目標入力画面（`/mandala/create/goal`）に遷移する
3. WHEN 「新規作成」ボタンにホバーする THEN ボタンの色が変化する
4. WHEN 「新規作成」ボタンにフォーカスする THEN ボタンが視覚的にハイライトされる

### 要件5: 検索機能

**ユーザーストーリー:** ユーザーとして、キーワードでマンダラチャートを検索したい。そうすることで、特定の目標を素早く見つけられる。

#### 受入基準

1. WHEN TOP画面が表示される THEN 検索入力フィールドが画面上部に表示される
2. WHEN 検索入力フィールドにキーワードを入力する THEN 入力した文字がリアルタイムで表示される
3. WHEN 検索キーワードを入力する THEN Systemは目標タイトルと目標説明を対象に部分一致検索を実行する
4. WHEN 検索結果が存在する THEN 一致するマンダラチャートのみが表示される
5. WHEN 検索結果が存在しない THEN 「該当するマンダラチャートが見つかりませんでした」というメッセージが表示される
6. WHEN 検索キーワードをクリアする THEN 全てのマンダラチャートが再表示される
7. WHEN 検索入力フィールドにフォーカスする THEN プレースホルダー「目標を検索...」が表示される

### 要件6: フィルター機能

**ユーザーストーリー:** ユーザーとして、目標状態でマンダラチャートをフィルタリングしたい。そうすることで、特定の状態の目標のみを表示できる。

#### 受入基準

1. WHEN TOP画面が表示される THEN フィルタードロップダウンが検索フィールドの横に表示される
2. WHEN フィルタードロップダウンを開く THEN 以下の選択肢が表示される：「全て」「下書き」「活動中」「完了」「一時停止」「中止」
3. WHEN フィルター条件を選択する THEN 選択した状態のマンダラチャートのみが表示される
4. WHEN フィルター条件が「全て」である THEN 全てのマンダラチャートが表示される
5. WHEN フィルター結果が存在しない THEN 「該当するマンダラチャートが見つかりませんでした」というメッセージが表示される
6. WHEN フィルター条件を変更する THEN 一覧が即座に更新される

### 要件7: ソート機能

**ユーザーストーリー:** ユーザーとして、マンダラチャートを並び替えたい。そうすることで、優先度や期限に応じて目標を管理できる。

#### 受入基準

1. WHEN TOP画面が表示される THEN ソートドロップダウンがフィルタードロップダウンの横に表示される
2. WHEN ソートドロップダウンを開く THEN 以下の選択肢が表示される：「作成日時（新しい順）」「作成日時（古い順）」「更新日時（新しい順）」「更新日時（古い順）」「達成期限（近い順）」「達成期限（遠い順）」「進捗率（高い順）」「進捗率（低い順）」
3. WHEN ソート条件を選択する THEN 選択した条件でマンダラチャートが並び替えられる
4. WHEN ソート条件が「作成日時（新しい順）」である THEN 作成日時の降順で表示される
5. WHEN ソート条件が「達成期限（近い順）」である THEN 達成期限の昇順で表示される
6. WHEN ソート条件を変更する THEN 一覧が即座に更新される

### 要件8: ページネーション機能

**ユーザーストーリー:** ユーザーとして、大量のマンダラチャートを効率的に閲覧したい。そうすることで、パフォーマンスを維持しながら全ての目標を確認できる。

#### 受入基準

1. WHEN マンダラチャートが20件を超える THEN ページネーションが表示される
2. WHEN ページネーションが表示される THEN 1ページあたり20件のマンダラチャートが表示される
3. WHEN ページネーションが表示される THEN 現在のページ番号が表示される
4. WHEN ページネーションが表示される THEN 総ページ数が表示される
5. WHEN 「次へ」ボタンをクリックする THEN 次のページに遷移する
6. WHEN 「前へ」ボタンをクリックする THEN 前のページに遷移する
7. WHEN 最初のページである THEN 「前へ」ボタンが無効化される
8. WHEN 最後のページである THEN 「次へ」ボタンが無効化される
9. WHEN ページ番号をクリックする THEN 該当ページに遷移する

### 要件9: 空状態表示

**ユーザーストーリー:** ユーザーとして、マンダラチャートが存在しない場合に適切なメッセージを表示したい。そうすることで、次のアクションを理解できる。

#### 受入基準

1. WHEN マンダラチャートが1件も存在しない THEN 空状態メッセージが表示される
2. WHEN 空状態メッセージが表示される THEN 「まだマンダラチャートがありません」というテキストが表示される
3. WHEN 空状態メッセージが表示される THEN 「新しい目標を作成して、マンダラチャートを始めましょう」という説明テキストが表示される
4. WHEN 空状態メッセージが表示される THEN 「新規作成」ボタンが表示される
5. WHEN 空状態の「新規作成」ボタンをクリックする THEN Systemは目標入力画面に遷移する

### 要件10: ユーザーメニュー機能

**ユーザーストーリー:** ユーザーとして、ユーザー設定やログアウトにアクセスしたい。そうすることで、アカウント管理ができる。

#### 受入基準

1. WHEN TOP画面が表示される THEN ユーザーメニューアイコンが画面右上に表示される
2. WHEN ユーザーメニューアイコンをクリックする THEN ドロップダウンメニューが表示される
3. WHEN ドロップダウンメニューが表示される THEN ユーザー名が表示される
4. WHEN ドロップダウンメニューが表示される THEN 「設定」メニュー項目が表示される
5. WHEN ドロップダウンメニューが表示される THEN 「ログアウト」メニュー項目が表示される
6. WHEN 「設定」メニュー項目をクリックする THEN Systemはユーザー設定画面（`/settings`）に遷移する
7. WHEN 「ログアウト」メニュー項目をクリックする THEN Systemはログアウト処理を実行し、ログイン画面（`/login`）にリダイレクトする

### 要件11: データ取得機能

**ユーザーストーリー:** システム開発者として、マンダラチャート一覧データを効率的に取得したい。そうすることで、パフォーマンスを最適化できる。

#### 受入基準

1. WHEN TOP画面が表示される THEN SystemはGET /api/goals エンドポイントにリクエストを送信する
2. WHEN APIリクエストを送信する THEN 認証トークンがAuthorizationヘッダーに含まれる
3. WHEN APIリクエストを送信する THEN クエリパラメータに検索キーワード、フィルター条件、ソート条件、ページ番号が含まれる
4. WHEN APIレスポンスを受信する THEN マンダラチャート一覧データが表示される
5. WHEN APIレスポンスを受信する THEN 総件数とページネーション情報が取得される
6. WHEN データ取得中である THEN ローディングスピナーが表示される
7. WHEN データ取得に失敗する THEN エラーメッセージ「データの取得に失敗しました」が表示される

### 要件12: 認証状態管理

**ユーザーストーリー:** システム開発者として、認証状態を適切に管理したい。そうすることで、未認証ユーザーのアクセスを防ぎ、セキュリティを確保できる。

#### 受入基準

1. WHEN 未認証ユーザーがTOP画面にアクセスする THEN Systemはログイン画面（`/login`）にリダイレクトする
2. WHEN 認証トークンが期限切れである THEN Systemはログイン画面にリダイレクトする
3. WHEN 認証トークンが無効である THEN Systemはログイン画面にリダイレクトする
4. WHEN プロフィール未設定ユーザーがTOP画面にアクセスする THEN Systemはプロフィール入力画面（`/profile/setup`）にリダイレクトする

### 要件13: レスポンシブデザイン

**ユーザーストーリー:** ユーザーとして、様々なデバイスでマンダラチャート一覧を閲覧したい。そうすることで、どのデバイスからでも快適に利用できる。

#### 受入基準

1. WHEN モバイル（< 768px）で表示する THEN マンダラチャートカードが1カラムで縦方向に配置される
2. WHEN タブレット（768px - 1024px）で表示する THEN マンダラチャートカードが2カラムで配置される
3. WHEN デスクトップ（> 1024px）で表示する THEN マンダラチャートカードが3カラムで配置される
4. WHEN モバイルで表示する THEN 検索・フィルター・ソート機能が縦方向に配置される
5. WHEN モバイルで表示する THEN タッチ操作に適したボタンサイズ（最小44px × 44px）が確保される
6. WHEN 画面サイズが変更される THEN レイアウトが適切に調整される

### 要件14: アクセシビリティ対応

**ユーザーストーリー:** 支援技術を使用するユーザーとして、マンダラチャート一覧を利用したい。そうすることで、全てのユーザーが平等にサービスを利用できる。

#### 受入基準

1. WHEN スクリーンリーダーを使用する THEN 各マンダラチャートカードの内容が適切に読み上げられる
2. WHEN スクリーンリーダーを使用する THEN 進捗率が「進捗率XX%」として読み上げられる
3. WHEN キーボードで操作する THEN Tabキーで全てのマンダラチャートカードとボタンにフォーカスできる
4. WHEN キーボードで操作する THEN Enterキーでマンダラチャートカードを選択できる
5. WHEN フォーカスが移動する THEN フォーカスインジケーターが明確に表示される
6. WHEN 検索・フィルター・ソート機能を使用する THEN aria-label属性が適切に設定される
7. WHEN ページネーションを使用する THEN 現在のページがaria-current属性で示される

### 要件15: パフォーマンス要件

**ユーザーストーリー:** ユーザーとして、マンダラチャート一覧を素早く表示したい。そうすることで、ストレスなく目標を管理できる。

#### 受入基準

1. WHEN TOP画面を表示する THEN 初回ロード時間が3秒以内である
2. WHEN 検索・フィルター・ソートを実行する THEN 結果が500ms以内に表示される
3. WHEN ページネーションを実行する THEN 次のページが1秒以内に表示される
4. WHEN APIリクエストを送信する THEN 95%のリクエストが2秒以内に完了する
5. WHEN 画像やアイコンを表示する THEN 遅延読み込みが適用される
6. WHEN マンダラチャートカードが20件以上である THEN 仮想スクロールが適用される（オプション）

### 要件16: エラーハンドリング

**ユーザーストーリー:** ユーザーとして、エラーが発生した場合に適切なフィードバックを受け取りたい。そうすることで、問題を理解し、適切に対処できる。

#### 受入基準

1. WHEN APIエラーが発生する THEN エラーメッセージが画面上部に表示される
2. WHEN ネットワークエラーが発生する THEN 「ネットワークエラーが発生しました」というメッセージが表示される
3. WHEN データ取得に失敗する THEN 「データの取得に失敗しました。もう一度お試しください。」というメッセージが表示される
4. WHEN 予期しないエラーが発生する THEN 「予期しないエラーが発生しました」というメッセージが表示される
5. WHEN エラーメッセージが表示される THEN 「再試行」ボタンが表示される
6. WHEN 「再試行」ボタンをクリックする THEN Systemはデータ取得を再実行する

### 要件17: ユーザーエクスペリエンス

**ユーザーストーリー:** ユーザーとして、直感的で使いやすいマンダラチャート一覧を利用したい。そうすることで、効率的に目標を管理できる。

#### 受入基準

1. WHEN TOP画面が表示される THEN ページタイトル「マンダラチャート一覧」が表示される
2. WHEN マンダラチャートカードにホバーする THEN カードが視覚的にハイライトされ、クリック可能であることが示される
3. WHEN データ取得中である THEN スケルトンスクリーンが表示される
4. WHEN 検索・フィルター・ソートを実行する THEN 実行中であることを示すローディングインジケーターが表示される
5. WHEN マンダラチャートが削除される THEN 一覧から即座に削除される（オプション機能）
6. WHEN マンダラチャートが更新される THEN 一覧が自動的に更新される（オプション機能）
