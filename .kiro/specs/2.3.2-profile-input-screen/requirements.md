# 要件定義書

## はじめに

この要件定義書は、初回ログイン時のプロフィール入力画面の実装について定義します。ユーザーが初めてログインした際に、所属組織情報（業種、組織規模）と本人情報（職種、役職）を入力し、AI生成時のコンテキスト情報として活用できるようにします。

## 要件

### 要件1: プロフィール入力フォーム表示

**ユーザーストーリー:** 初回ログインユーザーとして、プロフィール入力画面を表示したい。そうすることで、必要な情報を入力してサービスを開始できる。

#### 受入基準

1. WHEN 初回ログイン後にプロフィール情報が未設定である THEN `/profile/setup` にリダイレクトされる
2. WHEN プロフィール入力画面が表示される THEN 画面タイトル「プロフィール設定」が表示される
3. WHEN プロフィール入力画面が表示される THEN 「所属組織の情報」セクションが表示される
4. WHEN プロフィール入力画面が表示される THEN 「本人の情報」セクションが表示される
5. WHEN プロフィール入力画面が表示される THEN 「次へ」ボタンが表示される
6. WHEN プロフィール入力画面が表示される THEN レスポンシブデザインが適用され、モバイル・タブレット・デスクトップで適切に表示される

### 要件2: 業種選択機能

**ユーザーストーリー:** ユーザーとして、自分の業種を選択したい。そうすることで、業種に応じた適切なAI生成結果を得られる。

#### 受入基準

1. WHEN 業種入力フィールドが表示される THEN ドロップダウン形式で選択できる
2. WHEN 業種ドロップダウンを開く THEN 以下の選択肢が表示される：「IT・通信」「製造業」「金融・保険」「小売・卸売」「サービス業」「医療・福祉」「教育」「建設・不動産」「運輸・物流」「その他」
3. WHEN 業種を選択する THEN 選択した業種が表示される
4. WHEN 業種が未選択である THEN プレースホルダー「業種を選択してください」が表示される
5. WHEN 業種フィールドにフォーカスする THEN フィールドがハイライトされる
6. WHEN 業種を選択する THEN バリデーションエラーがクリアされる

### 要件3: 組織規模選択機能

**ユーザーストーリー:** ユーザーとして、自分の組織規模を選択したい。そうすることで、組織規模に応じた適切なAI生成結果を得られる。

#### 受入基準

1. WHEN 組織規模入力フィールドが表示される THEN ドロップダウン形式で選択できる
2. WHEN 組織規模ドロップダウンを開く THEN 以下の選択肢が表示される：「1-10人」「11-50人」「51-200人」「201-500人」「501-1000人」「1001人以上」「個人事業主」
3. WHEN 組織規模を選択する THEN 選択した組織規模が表示される
4. WHEN 組織規模が未選択である THEN プレースホルダー「組織規模を選択してください」が表示される
5. WHEN 組織規模フィールドにフォーカスする THEN フィールドがハイライトされる
6. WHEN 組織規模を選択する THEN バリデーションエラーがクリアされる

### 要件4: 職種入力機能

**ユーザーストーリー:** ユーザーとして、自分の職種を入力したい。そうすることで、職種に応じた適切なAI生成結果を得られる。

#### 受入基準

1. WHEN 職種入力フィールドが表示される THEN テキスト入力形式で入力できる
2. WHEN 職種フィールドにフォーカスする THEN プレースホルダー「例：ソフトウェアエンジニア」が表示される
3. WHEN 職種を入力する THEN 入力した文字がリアルタイムで表示される
4. WHEN 職種が100文字を超える THEN 入力が制限され、エラーメッセージ「職種は100文字以内で入力してください」が表示される
5. WHEN 職種フィールドにフォーカスする THEN フィールドがハイライトされる
6. WHEN 職種を入力する THEN バリデーションエラーがクリアされる

### 要件5: 役職入力機能（任意）

**ユーザーストーリー:** ユーザーとして、自分の役職を入力したい。そうすることで、役職に応じた適切なAI生成結果を得られる。

#### 受入基準

1. WHEN 役職入力フィールドが表示される THEN テキスト入力形式で入力できる
2. WHEN 役職フィールドにフォーカスする THEN プレースホルダー「例：マネージャー（任意）」が表示される
3. WHEN 役職を入力する THEN 入力した文字がリアルタイムで表示される
4. WHEN 役職が100文字を超える THEN 入力が制限され、エラーメッセージ「役職は100文字以内で入力してください」が表示される
5. WHEN 役職フィールドが空である THEN バリデーションエラーが発生しない（任意項目のため）
6. WHEN 役職フィールドにフォーカスする THEN フィールドがハイライトされる

### 要件6: フォームバリデーション

**ユーザーストーリー:** ユーザーとして、入力内容が正しいかどうかをリアルタイムで確認したい。そうすることで、送信前にエラーを修正できる。

#### 受入基準

1. WHEN 業種が未選択である AND 「次へ」ボタンをクリックする THEN エラーメッセージ「業種を選択してください」が表示される
2. WHEN 組織規模が未選択である AND 「次へ」ボタンをクリックする THEN エラーメッセージ「組織規模を選択してください」が表示される
3. WHEN 職種が未入力である AND 「次へ」ボタンをクリックする THEN エラーメッセージ「職種を入力してください」が表示される
4. WHEN 職種が100文字を超える THEN エラーメッセージ「職種は100文字以内で入力してください」が表示される
5. WHEN 役職が100文字を超える THEN エラーメッセージ「役職は100文字以内で入力してください」が表示される
6. WHEN バリデーションエラーが発生する THEN エラーメッセージが該当フィールドの下に赤色で表示される
7. WHEN バリデーションエラーが発生する THEN 該当フィールドが赤色の枠線でハイライトされる
8. WHEN エラーのあるフィールドを修正する THEN エラーメッセージが即座にクリアされる

### 要件7: プロフィール保存機能

**ユーザーストーリー:** ユーザーとして、入力したプロフィール情報を保存したい。そうすることで、サービスを利用開始できる。

#### 受入基準

1. WHEN 全ての必須項目が入力されている AND 「次へ」ボタンをクリックする THEN プロフィール情報がバックエンドAPIに送信される
2. WHEN プロフィール保存APIを呼び出す THEN PUT /api/profile エンドポイントにリクエストが送信される
3. WHEN プロフィール保存が成功する THEN TOP画面（`/`）にリダイレクトされる
4. WHEN プロフィール保存中である THEN 「次へ」ボタンが無効化され、ローディングスピナーが表示される
5. WHEN プロフィール保存中である THEN ボタンテキストが「保存中...」に変更される
6. WHEN プロフィール保存に失敗する THEN エラーメッセージ「プロフィールの保存に失敗しました。もう一度お試しください。」が画面上部に表示される
7. WHEN ネットワークエラーが発生する THEN エラーメッセージ「ネットワークエラーが発生しました。接続を確認してください。」が表示される

### 要件8: 認証状態管理

**ユーザーストーリー:** システム開発者として、認証状態を適切に管理したい。そうすることで、未認証ユーザーのアクセスを防ぎ、セキュリティを確保できる。

#### 受入基準

1. WHEN 未認証ユーザーが `/profile/setup` にアクセスする THEN ログイン画面（`/login`）にリダイレクトされる
2. WHEN 認証トークンが期限切れである THEN ログイン画面にリダイレクトされる
3. WHEN 認証トークンが無効である THEN ログイン画面にリダイレクトされる
4. WHEN プロフィール設定済みユーザーが `/profile/setup` にアクセスする THEN TOP画面（`/`）にリダイレクトされる
5. WHEN APIリクエストを送信する THEN 認証トークンがAuthorizationヘッダーに含まれる

### 要件9: レスポンシブデザイン

**ユーザーストーリー:** ユーザーとして、様々なデバイスでプロフィール入力画面を利用したい。そうすることで、どのデバイスからでも快適に入力できる。

#### 受入基準

1. WHEN モバイル（< 768px）で表示する THEN フォームが縦方向に配置され、1カラムレイアウトになる
2. WHEN タブレット（768px - 1024px）で表示する THEN フォームが適切な幅で表示され、読みやすいレイアウトになる
3. WHEN デスクトップ（> 1024px）で表示する THEN フォームが中央に配置され、最大幅が制限される
4. WHEN モバイルで表示する THEN タッチ操作に適したボタンサイズ（最小44px × 44px）が確保される
5. WHEN モバイルで表示する THEN ドロップダウンがネイティブの選択UIで表示される
6. WHEN 画面サイズが変更される THEN レイアウトが適切に調整される

### 要件10: アクセシビリティ対応

**ユーザーストーリー:** 支援技術を使用するユーザーとして、プロフィール入力画面を利用したい。そうすることで、全てのユーザーが平等にサービスを利用できる。

#### 受入基準

1. WHEN スクリーンリーダーを使用する THEN 全てのフォームフィールドに適切なラベルが読み上げられる
2. WHEN スクリーンリーダーを使用する THEN エラーメッセージが適切に読み上げられる
3. WHEN キーボードで操作する THEN Tabキーで全てのフォームフィールドとボタンにフォーカスできる
4. WHEN キーボードで操作する THEN Enterキーでフォームを送信できる
5. WHEN フォーカスが移動する THEN フォーカスインジケーターが明確に表示される
6. WHEN エラーが発生する THEN aria-invalid属性が該当フィールドに設定される
7. WHEN エラーが発生する THEN aria-describedby属性でエラーメッセージが関連付けられる
8. WHEN 必須フィールドが表示される THEN aria-required属性が設定される

### 要件11: パフォーマンス要件

**ユーザーストーリー:** ユーザーとして、プロフィール入力画面を素早く表示・操作したい。そうすることで、ストレスなく入力を完了できる。

#### 受入基準

1. WHEN プロフィール入力画面を表示する THEN 初回ロード時間が3秒以内である
2. WHEN フォームに入力する THEN 入力レスポンスが100ms以内である
3. WHEN バリデーションを実行する THEN バリデーション結果が200ms以内に表示される
4. WHEN プロフィール保存APIを呼び出す THEN 95%のリクエストが1秒以内に完了する
5. WHEN 画像やアイコンを表示する THEN 遅延読み込みが適用される

### 要件12: エラーハンドリング

**ユーザーストーリー:** ユーザーとして、エラーが発生した場合に適切なフィードバックを受け取りたい。そうすることで、問題を理解し、適切に対処できる。

#### 受入基準

1. WHEN APIエラーが発生する THEN エラーメッセージが画面上部に表示される
2. WHEN ネットワークエラーが発生する THEN 「ネットワークエラーが発生しました」というメッセージが表示される
3. WHEN バリデーションエラーが発生する THEN 該当フィールドの下にエラーメッセージが表示される
4. WHEN 予期しないエラーが発生する THEN 「予期しないエラーが発生しました」というメッセージが表示される
5. WHEN エラーメッセージが表示される THEN 5秒後に自動的に非表示になる（APIエラーの場合）
6. WHEN エラーメッセージが表示される THEN 閉じるボタンで手動で非表示にできる

### 要件13: ユーザーエクスペリエンス

**ユーザーストーリー:** ユーザーとして、直感的で使いやすいプロフィール入力画面を利用したい。そうすることで、スムーズに入力を完了できる。

#### 受入基準

1. WHEN プロフィール入力画面が表示される THEN 入力の目的と重要性を説明するテキストが表示される
2. WHEN フォームフィールドにフォーカスする THEN プレースホルダーが表示され、入力例が示される
3. WHEN 入力を進める THEN 進捗インジケーターが表示される（オプション）
4. WHEN 「次へ」ボタンにホバーする THEN ボタンの色が変化し、クリック可能であることが示される
5. WHEN プロフィール保存が成功する THEN 成功メッセージ「プロフィールを保存しました」が表示される
6. WHEN プロフィール保存が成功する THEN 1秒後にTOP画面にリダイレクトされる
