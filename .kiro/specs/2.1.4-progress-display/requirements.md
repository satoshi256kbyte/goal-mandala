# 要件定義書

## 概要

マンダラチャートシステムにおいて、目標、サブ目標、アクション、タスクの進捗状況を視覚的に表示する機能を実装します。ユーザーが現在の達成状況を直感的に把握でき、モチベーション維持に寄与する進捗表示システムを構築します。

## 要件

### 要件1: 進捗計算ロジック

**ユーザーストーリー:** システム管理者として、正確な進捗計算により、ユーザーの達成状況を適切に反映したいので、階層的な進捗計算機能が必要です。

#### 受入基準

1. WHEN タスクが完了状態に更新される THEN システムは自動的にアクションの進捗を再計算する
2. WHEN アクションの進捗が更新される THEN システムは自動的にサブ目標の進捗を再計算する
3. WHEN サブ目標の進捗が更新される THEN システムは自動的に目標の進捗を再計算する
4. WHEN 習慣アクションのタスクが継続中状態になる THEN システムは継続期間に基づいて進捗を計算する
5. WHEN 実行アクションの全タスクが完了する THEN システムはアクション進捗を100%に設定する

### 要件2: プログレスバーコンポーネント

**ユーザーストーリー:** ユーザーとして、現在の進捗状況を視覚的に把握したいので、分かりやすいプログレスバー表示が必要です。

#### 受入基準

1. WHEN 進捗データが提供される THEN プログレスバーは0-100%の範囲で進捗を表示する
2. WHEN 進捗が50%未満の場合 THEN プログレスバーは赤色で表示される
3. WHEN 進捗が50-80%の場合 THEN プログレスバーは黄色で表示される
4. WHEN 進捗が80%以上の場合 THEN プログレスバーは緑色で表示される
5. WHEN プログレスバーにホバーする THEN 詳細な進捗情報がツールチップで表示される

### 要件3: 色分け表示機能

**ユーザーストーリー:** ユーザーとして、進捗状況を色で直感的に判断したいので、統一された色分けルールによる表示が必要です。

#### 受入基準

1. WHEN マンダラチャートのセルが表示される THEN 進捗に応じて背景色が変更される
2. WHEN 進捗が0%の場合 THEN セルは灰色で表示される
3. WHEN 進捗が1-49%の場合 THEN セルは薄い赤色で表示される
4. WHEN 進捗が50-79%の場合 THEN セルは薄い黄色で表示される
5. WHEN 進捗が80-99%の場合 THEN セルは薄い緑色で表示される
6. WHEN 進捗が100%の場合 THEN セルは濃い緑色で表示される

### 要件4: アニメーション効果

**ユーザーストーリー:** ユーザーとして、進捗の変化を視覚的に感じたいので、スムーズなアニメーション効果が必要です。

#### 受入基準

1. WHEN 進捗が更新される THEN プログレスバーは滑らかにアニメーションしながら新しい値に変化する
2. WHEN セルの色が変更される THEN 0.3秒のフェードイン効果で色が変化する
3. WHEN 進捗が100%に達する THEN 達成を示す特別なアニメーション効果が表示される
4. WHEN アニメーション中にユーザーが他の操作を行う THEN アニメーションは中断されずに継続する
5. WHEN ユーザーがアニメーション無効設定を選択している THEN アニメーション効果は表示されない

### 要件5: 進捗履歴表示機能

**ユーザーストーリー:** ユーザーとして、過去の進捗変化を確認したいので、進捗履歴を表示する機能が必要です。

#### 受入基準

1. WHEN ユーザーが進捗履歴を要求する THEN 過去30日間の進捗変化がグラフで表示される
2. WHEN 進捗履歴グラフが表示される THEN 日付と進捗率が軸として表示される
3. WHEN 特定の日付をクリックする THEN その日の詳細な進捗情報が表示される
4. WHEN 進捗に大きな変化があった日 THEN グラフ上でハイライト表示される
5. WHEN 進捗履歴データが存在しない THEN 適切なメッセージが表示される
