# 実装計画

- [x] 1. VpcStackクラスの基本構造作成
  - VpcStackクラスの定義とコンストラクタ実装
  - VpcStackPropsインターフェースの定義
  - 基本的なVPC作成ロジックの実装
  - _要件: 1.1, 1.2, 1.3_

- [x] 2. サブネット構成の実装
  - パブリックサブネット設定の実装
  - プライベートサブネット設定の実装
  - データベース用分離サブネット設定の実装
  - 2つのアベイラビリティゾーンへの分散配置実装
  - _要件: 1.2, 1.3_

- [x] 3. インターネットゲートウェイとルーティング設定
  - インターネットゲートウェイの作成と関連付け
  - パブリックサブネット用ルートテーブル設定
  - プライベートサブネット用ルートテーブル設定
  - _要件: 1.4_

- [x] 4. NATゲートウェイの環境別実装
  - 環境設定に基づくNATゲートウェイ数の制御ロジック実装
  - 本番環境用の冗長NATゲートウェイ設定
  - 開発環境用の単一NATゲートウェイ設定
  - プライベートサブネットからのアウトバウンドルーティング設定
  - _要件: 1.5, 4.1, 4.2_

- [x] 5. セキュリティグループの作成と設定
  - createSecurityGroups()メソッドの実装
  - ALB用セキュリティグループの作成と設定
  - Lambda用セキュリティグループの作成と設定
  - データベース用セキュリティグループの作成と設定
  - セキュリティグループ間の適切な通信ルール設定
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 6. VPCフローログの設定
  - CloudWatch Logsグループの作成
  - VPCフローログの設定と有効化
  - ログ保持期間の設定
  - 適切なIAMロールの自動作成
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 7. VPCエンドポイントの環境別実装
  - createVpcEndpoints()メソッドの実装
  - 環境別VPCエンドポイント作成制御ロジック
  - S3とDynamoDB用Gatewayエンドポイントの作成
  - Secrets Manager、CloudWatch Logs、Bedrock用Interfaceエンドポイントの作成
  - VPCエンドポイント用セキュリティグループの関連付け
  - _要件: 4.3, 4.4, 5.1, 5.2, 5.3, 5.4_

- [x] 8. CloudFormation出力の実装
  - createOutputs()メソッドの実装
  - VPC IDとCIDRブロックの出力設定
  - サブネットID（パブリック、プライベート、分離）の出力設定
  - セキュリティグループIDの出力設定
  - アベイラビリティゾーン情報の出力設定
  - 他スタックからのインポート可能な形式での出力設定
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 9. タグ管理の実装
  - applyTags()メソッドの実装
  - 環境名、プロジェクト名の自動タグ付与
  - セキュリティグループ用途別Nameタグの設定
  - 設定ファイルベースのカスタムタグ適用
  - 一貫したタグ命名規則の実装
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [x] 10. 既存スタックとの統合
  - DatabaseStackからVPC作成ロジックの分離
  - DatabaseStackでVpcStackのVPCとセキュリティグループを参照するよう修正
  - ApiStackでVpcStackのリソースを参照するよう修正
  - メインCDKアプリケーションでのスタック依存関係設定
  - _要件: 6.1, 6.2, 6.3_

- [x] 11. ユニットテストの実装
  - VpcStackクラスのテストファイル作成
  - VPC作成テストの実装
  - サブネット設定テストの実装
  - セキュリティグループ設定テストの実装
  - 環境別設定テスト（NATゲートウェイ数、VPCエンドポイント）の実装
  - CloudFormation出力テストの実装
  - _要件: 全要件の検証_

- [x] 12. 統合テストとドキュメント更新
  - スタック全体のデプロイテスト実行
  - VPC接続性の確認
  - セキュリティグループルールの動作確認
  - README.mdの更新（VPCスタックの説明追加）
  - トラブルシューティングガイドの更新
  - _要件: 全要件の統合確認_
