# 要件ドキュメント

## 概要

新規マンダラチャート作成時の目標入力フォーム機能を実装します。ユーザーが目標に関する詳細情報を入力し、AI生成処理を開始するためのフォーム画面を提供します。

## 要件

### 要件1: 目標入力フォーム表示

**ユーザーストーリー:** ユーザーとして、新しい目標を設定するために、目標に関する詳細情報を入力できるフォームを表示したい

#### 受入基準

1. WHEN ユーザーが目標入力画面（`/mandala/create/goal`）にアクセス THEN システムは目標入力フォームを表示する
2. WHEN フォームが表示される THEN 以下の入力項目が含まれている
   - 目標タイトル（必須、テキスト入力）
   - 目標説明（必須、テキストエリア）
   - 達成期限（必須、日付選択）
   - 背景（必須、テキストエリア）
   - 制約事項（任意、テキストエリア）
3. WHEN フォームが表示される THEN 各入力項目にはラベルとプレースホルダーが設定されている
4. WHEN フォームが表示される THEN 必須項目には視覚的な必須マークが表示されている

### 要件2: 入力バリデーション機能

**ユーザーストーリー:** ユーザーとして、入力内容に問題がある場合は適切なエラーメッセージを表示してほしい

#### 受入基準

1. WHEN 必須項目が未入力の状態でフォーム送信 THEN 該当項目にエラーメッセージを表示する
2. WHEN 目標タイトルが100文字を超える THEN 文字数制限エラーを表示する
3. WHEN 目標説明が1000文字を超える THEN 文字数制限エラーを表示する
4. WHEN 達成期限が過去の日付 THEN 無効な日付エラーを表示する
5. WHEN 達成期限が1年以上先の日付 THEN 期限が長すぎるエラーを表示する
6. WHEN 背景が500文字を超える THEN 文字数制限エラーを表示する
7. WHEN 制約事項が500文字を超える THEN 文字数制限エラーを表示する

### 要件3: 文字数カウント機能

**ユーザーストーリー:** ユーザーとして、入力中の文字数を確認して制限内で入力を調整したい

#### 受入基準

1. WHEN ユーザーがテキスト入力項目に文字を入力 THEN リアルタイムで文字数カウンターが更新される
2. WHEN 文字数が制限の80%を超える THEN 文字数表示が警告色に変わる
3. WHEN 文字数が制限を超える THEN 文字数表示がエラー色に変わる
4. WHEN 文字数制限に達する THEN それ以上の入力を制限する

### 要件4: 日付ピッカー機能

**ユーザーストーリー:** ユーザーとして、達成期限を直感的に選択できる日付ピッカーを使用したい

#### 受入基準

1. WHEN ユーザーが達成期限フィールドをクリック THEN 日付ピッカーが表示される
2. WHEN 日付ピッカーが表示される THEN 現在日以降の日付のみ選択可能である
3. WHEN 日付ピッカーが表示される THEN 1年以内の日付のみ選択可能である
4. WHEN ユーザーが日付を選択 THEN フィールドに選択した日付が表示される
5. WHEN ユーザーが手動で日付を入力 THEN 有効な日付形式（YYYY-MM-DD）で入力できる

### 要件5: 下書き保存機能

**ユーザーストーリー:** ユーザーとして、入力途中の内容を一時保存して後で続きから入力したい

#### 受入基準

1. WHEN ユーザーが入力中 THEN 30秒ごとに自動で下書き保存される
2. WHEN ユーザーが「下書き保存」ボタンをクリック THEN 手動で下書き保存される
3. WHEN 下書きが保存される THEN 保存完了メッセージが表示される
4. WHEN ユーザーが再度画面にアクセス THEN 保存された下書きが復元される
5. WHEN 下書きが復元される THEN 復元されたことを示すメッセージが表示される

### 要件6: AI生成開始機能

**ユーザーストーリー:** ユーザーとして、入力完了後にAI生成処理を開始したい

#### 受入基準

1. WHEN 全ての必須項目が入力済み THEN 「AI生成開始」ボタンが有効になる
2. WHEN 必須項目に未入力がある THEN 「AI生成開始」ボタンが無効状態である
3. WHEN ユーザーが「AI生成開始」ボタンをクリック THEN 入力内容の最終バリデーションが実行される
4. WHEN バリデーションが成功 THEN 目標データが保存され、AI処理中画面に遷移する
5. WHEN バリデーションが失敗 THEN エラーメッセージを表示し、フォームに留まる

### 要件7: レスポンシブ対応

**ユーザーストーリー:** ユーザーとして、デスクトップ、タブレット、スマートフォンのどのデバイスでも快適に入力したい

#### 受入基準

1. WHEN デスクトップ画面で表示 THEN 2カラムレイアウトでフォームが表示される
2. WHEN タブレット画面で表示 THEN 1カラムレイアウトでフォームが表示される
3. WHEN スマートフォン画面で表示 THEN 縦スクロール可能な1カラムレイアウトで表示される
4. WHEN 各デバイスで表示 THEN 入力フィールドのサイズが適切に調整される
5. WHEN 各デバイスで表示 THEN タッチ操作に適したボタンサイズが提供される

### 要件8: アクセシビリティ対応

**ユーザーストーリー:** 視覚障害や運動障害のあるユーザーとして、支援技術を使用してフォームを操作したい

#### 受入基準

1. WHEN スクリーンリーダーを使用 THEN 各入力項目のラベルと説明が読み上げられる
2. WHEN キーボードのみで操作 THEN Tabキーで全ての要素にフォーカス移動できる
3. WHEN フォーカスが移動 THEN 視覚的なフォーカスインジケーターが表示される
4. WHEN エラーが発生 THEN エラー内容がスクリーンリーダーで読み上げられる
5. WHEN フォームを送信 THEN 処理状況がスクリーンリーダーで通知される

### 要件9: パフォーマンス要件

**ユーザーストーリー:** ユーザーとして、フォームの表示と操作が快適に行えるレスポンス速度を期待する

#### 受入基準

1. WHEN フォーム画面にアクセス THEN 2秒以内にフォームが表示される
2. WHEN 入力操作を行う THEN 100ms以内にUIが反応する
3. WHEN バリデーションを実行 THEN 500ms以内に結果が表示される
4. WHEN 下書き保存を実行 THEN 1秒以内に保存が完了する
5. WHEN AI生成を開始 THEN 3秒以内に次画面に遷移する
