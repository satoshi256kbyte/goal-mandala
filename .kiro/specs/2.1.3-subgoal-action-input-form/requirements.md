# 要件書

## 概要

AI生成されたサブ目標とアクションを確認・編集するためのフォーム機能を実装します。ユーザーは目標から生成された8つのサブ目標と、各サブ目標に対する8つのアクション（合計64個）を確認し、必要に応じて編集できます。

## 要件

### 要件1

**ユーザーストーリー:** ユーザーとして、AI生成されたサブ目標を確認・編集したいので、サブ目標一覧表示と編集機能が必要です

#### 受入基準

1. WHEN ユーザーがサブ目標確認画面にアクセス THEN システムは8つのサブ目標を一覧表示する
2. WHEN ユーザーがサブ目標を選択 THEN システムは編集可能な詳細フォームを表示する
3. WHEN ユーザーがサブ目標を編集 THEN システムはリアルタイムでバリデーションを実行する
4. WHEN ユーザーが編集を保存 THEN システムは変更をデータベースに保存し成功メッセージを表示する
5. WHEN ユーザーが「再生成」ボタンをクリック THEN システムはAI再生成処理を開始する

### 要件2

**ユーザーストーリー:** ユーザーとして、AI生成されたアクションを確認・編集したいので、アクション一覧表示と編集機能が必要です

#### 受入基準

1. WHEN ユーザーがアクション確認画面にアクセス THEN システムは64個のアクションをサブ目標別に表示する
2. WHEN ユーザーがサブ目標を選択 THEN システムは該当する8つのアクションを表示する
3. WHEN ユーザーがアクションを選択 THEN システムは編集可能な詳細フォームを表示する
4. WHEN ユーザーがアクション種別を変更 THEN システムは実行/習慣の選択肢を提供する
5. WHEN ユーザーがアクションを編集 THEN システムはリアルタイムでバリデーションを実行する

### 要件3

**ユーザーストーリー:** ユーザーとして、効率的にフォーム入力したいので、動的フォーム機能が必要です

#### 受入基準

1. WHEN ユーザーがフォームフィールドにフォーカス THEN システムは該当フィールドをハイライト表示する
2. WHEN ユーザーが必須フィールドを空にする THEN システムはリアルタイムエラーメッセージを表示する
3. WHEN ユーザーが文字数制限を超過 THEN システムは警告メッセージと残り文字数を表示する
4. WHEN ユーザーがタブキーを押下 THEN システムは次のフィールドにフォーカスを移動する
5. WHEN ユーザーがEnterキーを押下 THEN システムは保存処理を実行する

### 要件4

**ユーザーストーリー:** ユーザーとして、直感的に項目を並び替えたいので、ドラッグ&ドロップ機能が必要です

#### 受入基準

1. WHEN ユーザーがサブ目標をドラッグ THEN システムはドラッグ可能な視覚的フィードバックを提供する
2. WHEN ユーザーがサブ目標をドロップ THEN システムは新しい位置に項目を移動する
3. WHEN ユーザーがアクションをドラッグ THEN システムは同一サブ目標内でのみ移動を許可する
4. WHEN ユーザーが並び替えを完了 THEN システムは新しい順序をデータベースに保存する
5. WHEN ユーザーが無効な位置にドロップ THEN システムは元の位置に項目を戻す

### 要件5

**ユーザーストーリー:** ユーザーとして、複数項目を効率的に編集したいので、一括編集機能が必要です

#### 受入基準

1. WHEN ユーザーが複数項目を選択 THEN システムは選択状態を視覚的に表示する
2. WHEN ユーザーが「一括編集」ボタンをクリック THEN システムは一括編集モードに切り替える
3. WHEN ユーザーが一括編集で共通項目を変更 THEN システムは選択された全項目に変更を適用する
4. WHEN ユーザーが一括削除を実行 THEN システムは確認ダイアログを表示する
5. WHEN ユーザーが一括操作を確定 THEN システムは変更をデータベースに保存する

### 要件6

**ユーザーストーリー:** ユーザーとして、入力内容を安全に保存したいので、下書き保存機能が必要です

#### 受入基準

1. WHEN ユーザーがフォーム入力中 THEN システムは30秒間隔で自動下書き保存を実行する
2. WHEN ユーザーが「下書き保存」ボタンをクリック THEN システムは即座に下書きを保存する
3. WHEN ユーザーが画面を離れる THEN システムは未保存の変更について確認ダイアログを表示する
4. WHEN ユーザーが画面に戻る THEN システムは下書きデータの復元オプションを提供する
5. WHEN ユーザーが下書きを復元 THEN システムは保存済みの下書きデータをフォームに反映する

### 要件7

**ユーザーストーリー:** ユーザーとして、モバイルデバイスでも快適に操作したいので、レスポンシブ対応が必要です

#### 受入基準

1. WHEN ユーザーがモバイルデバイスでアクセス THEN システムはタッチ操作に最適化されたUIを表示する
2. WHEN ユーザーがタブレットでアクセス THEN システムは中間サイズに最適化されたレイアウトを表示する
3. WHEN ユーザーがデスクトップでアクセス THEN システムは大画面に最適化されたレイアウトを表示する
4. WHEN ユーザーが画面サイズを変更 THEN システムは動的にレイアウトを調整する
5. WHEN ユーザーがタッチデバイスでドラッグ操作 THEN システムはタッチジェスチャーに対応する

### 要件8

**ユーザーストーリー:** ユーザーとして、アクセシビリティに配慮された操作をしたいので、キーボード操作とスクリーンリーダー対応が必要です

#### 受入基準

1. WHEN ユーザーがキーボードのみで操作 THEN システムは全機能にキーボードでアクセス可能にする
2. WHEN ユーザーがTabキーで移動 THEN システムは論理的な順序でフォーカスを移動する
3. WHEN ユーザーがスクリーンリーダーを使用 THEN システムは適切なARIAラベルを提供する
4. WHEN ユーザーがフォーカス状態を確認 THEN システムは明確な視覚的フォーカス表示を提供する
5. WHEN ユーザーがエラー状態を確認 THEN システムはスクリーンリーダーで読み上げ可能なエラーメッセージを提供する
